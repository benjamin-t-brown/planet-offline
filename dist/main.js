!function(){var t=new function(){var t,e,s,i,r,a,h,l,n,c,o,p;this._params=new function(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}},this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(o=.5-t.n/2,p=5e-5*-t.o),l=1+t.l*t.l*(t.l>0?-.9:10),n=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return t=i.b*i.b*1e5,e=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((t+e+s)/3|0)},this.synthWave=function(d,u){var f=this._params,x=1!=f.s||f.v,y=f.v*f.v*.1,m=1+3e-4*f.w,w=f.s*f.s*f.s*.1,g=1+1e-4*f.t,v=1!=f.s,_=f.x*f.x,b=f.g,F=f.q||f.r,A=f.r*f.r*f.r*.2,S=f.q*f.q*(f.q<0?-1020:1020),z=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,M=f.d,k=f.j/2,C=f.k*f.k*.01,E=f.a,P=t,B=1/t,T=1/e,I=1/s,L=5/(1+f.u*f.u*20)*(.01+w);L>.8&&(L=.8),L=1-L;for(var O,D,H,Y,q,N,R=!1,V=0,$=0,U=0,W=0,j=0,J=0,G=0,X=0,Z=0,K=0,Q=new Array(1024),tt=new Array(32),et=Q.length;et--;)Q[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<u;et++){if(R)return et;if(z&&++Z>=z&&(Z=0,this.reset()),c&&++n>=c&&(c=0,i*=l),(i*=a+=h)>r&&(i=r,b>0&&(R=!0)),D=i,k>0&&(K+=C,D*=1+Math.sin(K)*k),(D|=0)<8&&(D=8),E||((o+=p)<0?o=0:o>.5&&(o=.5)),++$>P)switch($=0,++V){case 1:P=e;break;case 2:P=s}switch(V){case 0:U=$*B;break;case 1:U=1+2*(1-$*T)*M;break;case 2:U=1-$*I;break;case 3:U=0,R=!0}F&&((H=0|(S+=A))<0?H=-H:H>1023&&(H=1023)),x&&m&&((y*=m)<1e-5?y=1e-5:y>.1&&(y=.1)),N=0;for(var st=8;st--;){if(++G>=D&&(G%=D,3==E))for(var it=tt.length;it--;)tt[it]=2*Math.random()-1;switch(E){case 0:q=G/D<o?.5:-.5;break;case 1:q=1-G/D*2;break;case 2:q=.225*(((q=1.27323954*(Y=6.28318531*((Y=G/D)>.5?Y-1:Y))+.405284735*Y*Y*(Y<0?1:-1))<0?-1:1)*q*q-q)+q;break;case 3:q=tt[Math.abs(32*G/D|0)]}x&&(O=J,(w*=g)<0?w=0:w>.1&&(w=.1),v?(j+=(q-J)*w,j*=L):(J=q,j=0),W+=(J+=j)-O,q=W*=1-y),F&&(Q[X%1024]=q,q+=Q[(X-H+1024)%1024],X++),N+=q}N*=.125*U*_,d[et]=N>=1?32767:N<=-1?-32768:32767*N|0}return u}},e=function(e){t._params.setSettings(e);var s=t.totalReset(),i=new Uint8Array(4*((s+1)/2|0)+44),r=2*t.synthWave(new Uint16Array(i.buffer,44),s),a=new Uint32Array(i.buffer,0,44);a[0]=1179011410,a[1]=r+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=r,r+=44;for(var h=0,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="data:audio/wav;base64,";h<r;h+=3){var c=i[h]<<16|i[h+1]<<8|i[h+2];n+=l[c>>18]+l[c>>12&63]+l[c>>6&63]+l[63&c]}return n};"function"==typeof require?module.exports=e:this.jsfxr=e}(),function(){let t={canvas_id:"c",canvas:null,ctx:null,sprites:{},frame:0,width:window.innerWidth,height:window.innerHeight,mute:!1,sounds:[],animations:{},transform:{x:0,y:0}};class e{constructor(t,e){this.name=t,this.loop=e||!1,this.sprites=[],this.cf=0,this.cf_max=0,this.cind=0,this.is_done=!1}s(t,e){this.sprites.push({max_frames:e,name:t}),1===this.sprites.length&&(this.cf_max=e)}update(){this.cf++,this.cf>=this.cf_max&&(this.cind++,this.cind>=this.sprites.length&&(this.is_done=!0,this.loop?this.cind=0:this.cind--),this.cf=0,this.cf_max=this.sprites[this.cind].max_frames)}getSprite(){return this.sprites[this.cind].name}}t.setCanv=function(e){t.canvas=e,t.ctx=e.getContext("2d")},t.restoreCanv=function(){t.canvas_id=t.canvas_id,t.canvas=document.getElementById(t.canvas_id),t.ctx=t.canvas.getContext("2d"),t.width=t.canvas.width,t.height=t.canvas.height},t.createSprite=function(s,i,r,a,h){let l={name:s,drot:i,shapes:r,w:a,h:h};t.sprites[s]=l,t.preDrawSprite(l),t.cAnim(s,()=>{let t=new e(s,!1);return t.s(s,2),t})},t.cAnim=function(e,s){t.animations[e]=s},t.normalize=function(t,e,s,i,r){return i+(t-e)*(r-i)/(s-e)},t.randbtwn=function(e,s){return Math.round(t.normalize(Math.random(),0,1,e,s))},t.distance=function(t,e,s,i){let r=s-t,a=i-e;return Math.sqrt(r*r+a*a)},t.hedToVec=function(t,e){return{x:e*Math.sin(Math.PI*t/180),y:-e*Math.cos(Math.PI*t/180)}},t.loadSounds=function(){let e=window.jsfxr,s=(s,i)=>{let r=e(i),a=[];for(let t=0;t<4;t++){let t=new Audio;t.src=r,a.push(t)}t.sounds[s]={cc:0,channels:a}};s("sand",[3,.13,.26,.95,.35,.37,,.5,,.19,.37,.8799,.35,,,,,,1,-.92,.12,.1614,,.25]),s("bomb",[0,.13,.26,.53,.35,.04,,.5,,.19,.37,.1799,.35,,,.56,-.86,.76,1,.56,.68,.78,-.4599,.25]),s("coin",[0,,.0917,.37,.32,.54,,,,.23,.02,.4813,.65,,,,.8,,1,,.11,,,.25]),s("expa",[3,,.1083,.3869,.3314,.1406,,-.2676,,,,,,,,,.5116,-.2477,1,,,,,.25]),s("expg",[3,,.3646,.7897,.2321,.1281,,-.3439,,,,,,,,,.2502,-.0041,1,,,,,.25]),s("bombg",[3,,.01,.6031,.4332,.027,,.2071,,,,,,,,,,,1,,,,,.25]),s("bullet",[1,.0054,.2302,,.2346,.9064,.1659,-.6154,.0044,.0708,.0179,.0085,.066,.5,-.5604,.0104,.0832,-.0182,.9625,.0138,.1126,.088,.0132,.25]),s("lazer1",[2,.0054,.2302,,.2346,.76,,-.6154,.0044,.0708,.0179,.0085,.066,.5,-.5604,.0104,.0832,-.0182,.9625,.0138,.1126,.088,.0132,.25]),s("upl",[0,,.26,,.8,.45,,.305,,,,,,.5555,,.6,,,1,,,,,.25]),s("hp",[0,,.2084,,.2832,.5027,,-.48,.6599,,,,,.316,,,,,.5663,,,,,.5]),s("blip",[1,,.1086,,.1316,.2639,,,,,,,,,,,,,1,,,.1,,.25]),s("harpoon",[3,,.1128,.95,.51,.4741,,-.287,,,,,,,,.3824,.5549,-.2718,1,,,,,.25]),s("uplf",[1,,.57,.1,.0482,.16,,,.02,.11,.32,,,,,,,,1,,,.1,,.25]),s("lvlfail",[0,,.52,.25,1,.27,,,,.47,.12,.1999,.14,.3,.6399,.552,,,1,,.13,,,.25]),s("lvlcomplete",[0,.04,.23,.19,.59,.24,,,,,,,,.5161,,,,,1,,,.1,,.25]),s("hit",[3,,.0887,,.1681,.6516,,-.4825,,,,,,,,,,,1,,,.129,,.25]),s("special",[1,,.34,,.67,.16,,.4536,,,,-.24,,,,.4182,,,.39,,,,,.25]),s("lvlstart",[3,.28,.31,.08,.7,.0081,,.4503,.0324,.8,.3,.62,.25,.3357,.1636,-.9992,.06,.24,.9625,,-.7401,,.0036,.3])},t.playSound=function(e){if(t.mute)return;let s=t.sounds[e],i=s&&s.cc++%s.channels.length;s.channels[i].play()},t.setError=function(e){t.error=!0},t.setLoop=function(e){let s=0,i=r=>{r*=.001,t.delta_t=r-s,s=r,t.frame++,t.frame>720&&(t.frame=0),e(),t.error||window.requestAnimationFrame(i)};window.requestAnimationFrame(i)},t.getCtx=function(){return t.ctx},t.clearScreen=function(){let e=t.getCtx();e.fillStyle="black",e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.rect=function({x:e=0,y:s=0,w:i,h:r,color:a,c:h,rot:l=0,outline:n=!1}){let c=t.getCtx();c.rotate(l*Math.PI/180),n&&(c.fillStyle="#111",c.fillRect(e-i/2-1,s-r/2-1,i+2,r+2)),c.fillStyle=a||h,c.fillRect(e-i/2,s-r/2,i,r)},t.circle=function({x:e=0,y:s=0,r:i=0,color:r,c:a,o:h}){let l=t.getCtx();l.lineWidth=3,l.fillStyle=r||a,l.beginPath(),l.arc(e,s,i,0,2*Math.PI),h?(l.strokeStyle=r||a,l.stroke()):l.fill()},t.rotate=function(e,{x:s=0,y:i=0,w:r=0,h:a=0}){let h=t.getCtx();return void 0!==e&&(s-=r/2,i-=a/2,h.translate(s,i),h.translate(r,a),h.rotate(e*Math.PI/180),s=-r/2,i=-a/2),{x:s,y:i}},t.line=function({x:e,y:s,x2:i,y2:r,color:a,w:h=3}){let l=t.getCtx();l.beginPath(),l.lineWidth=h,l.strokeStyle=a,l.moveTo(e,s),l.lineTo(i,r),l.stroke()},t.getAnim=function(e){if(t.animations[e]){const s=t.animations[e]();return s.name=e,s}return t.setError(),null},t.preDrawSprite=function(e){let s=document.createElement("canvas"),i=s.getContext("2d");s.width=e.w||1,s.height=e.h||1,t.setCanv(s),i.clearRect(0,0,e.w,e.h),i.save(),i.translate(e.w/2,e.h/2),e.shapes.forEach(e=>{(e.c||e.color)&&(i.save(),e.outline=void 0===e.outline||e.outline,t[e.type||"rect"].call(t,e),i.restore())}),e.canvas=s,i.restore(),t.restoreCanv()},t.drawSprite=function(e,s,i,r,a){let h=this.sprites[e];if(!h)return void t.setError('no sprite exists named "'+e+'"');let l={x:s-h.w/2,y:i-h.h/2};h.x=l.x,h.y=l.y;let n=t.getCtx();n.save(),void 0===a?h.drot&&(l=t.rotate(t.frame*h.drot%360,h)):l=t.rotate(a,h),n.drawImage(h.canvas,l.x,l.y),n.restore()},t.drawText=function(e,s,i,r){let a=t.getCtx(),{font:h,size:l,color:n}=r||{};a.font=(l||16)+"px "+(h||"monospace"),a.fillStyle=n||"white",a.fillText(e,s,i)},t.drawAnim=function(e,s,i,r,a){let h=e.getSprite();t.drawSprite(h,s,i,r,a),e.update()},t.drawAnimation=t.drawAnim,t.init=function(s,i){if(s&&(t.canvas_id=s,t.restoreCanv()),t.loaded)return void i();if(t.loading)return;t.loadSounds(),window.app.sprites.createSprites();t.cAnim("player_default",()=>{let t=new e("",!1);return t.s("p2",5),t}),t.cAnim("player_from_left",()=>{let t=new e("",!1);return t.s("p1",5),t.s("p2",5),t}),t.cAnim("player_from_right",()=>{let t=new e("",!1);return t.s("p3",5),t.s("p2",5),t}),t.cAnim("player_left",()=>{let t=new e("",!1);return t.s("p1",5),t.s("p0",5),t}),t.cAnim("player_right",()=>{let t=new e("",!1);return t.s("p3",5),t.s("p4",5),t});t.cAnim("expl_air",()=>{let t=new e("",!1);for(let e=0;e<=4;e++)t.s(`expl${e}`,6);return t}),t.cAnim("expl_bomb",()=>{let t=new e("",!1);for(let e=5;e<=9;e++)t.s(`expl${e}`,6);return t}),t.cAnim("expl_lazer",()=>{let t=new e("",!1);for(let e=0;e<=2;e++)t.s(`expl1${e}`,6);return t}),t.cAnim("cache",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`cache${e}`,4);return t.s("cache1",4),t}),t.cAnim("flash",()=>{let t=new e("",!1);return t.s("flash1",5),t}),t.cAnim("pwrcoin",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`pc${e}`,4);return t.s("pc1",8),t}),t.cAnim("plug",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`plug${e}`,4);return t.s("plug1",8),t}),t.cAnim("plugdead",()=>{let t=new e("",!1);return t.s("plug4",8),t}),i()},window.app.display=t}(),window.app.level="sl,275,1|sl,533,2|sl,800,3|bl,1,1|bl,279,2|bl,538,3|p,80,15|s,38,c,a,1,15|u,10,57,4|u,15,41,4|c,27,73,5,2x|g,10,65,1|g,9,41,1|g,24,81,1|g,3,94,1|c,15,105,5,coin5|c,29,107,5,coin2|u,7,114,2|u,15,126,2|g,15,116,1|g,7,125,1|g,28,123,1|c,19,144,10,hp|u,4,173,2|u,13,178,4|g,25,185,1|g,3,208,1|g,12,214,1|g,10,226,1|p,257,20|u,5,241,2|u,28,243,2|g,11,246,2|g,29,240,1|c,20,249,5,coin3|s,62,c,a,1,15|s,70,c,a,1,15|s,77,c,a,1,15|w,78,5,s,78,c,a,1,15|s,89,l,a,1,15|s,96,r,a,1,10|s,111,l,a,1,10|w,78,5,s,78,l,a,1,5|w,78,10,s,78,c,a,1,20|s,110,r,a,1,10|s,128,r,a,1,10|s,147,r,a,1,10|s,186,a,a,1,26|s,208,r,a,1,20|s,223,r,a,1,20|s,238,r,a,1,20|s,255,c,a,1,10|s,255,r,a,1,10|s,255,l,a,1,10|s,216,l,a,1,10|s,232,l,a,1,10|s,199,l,a,1,10|s,159,c,a,1,10|s,168,l,a,1,10|s,139,l,a,1,15|c,12,193,5,2x|c,23,228,5,hp|s,50,c,a,1,15|u,23,14,3|w,255,8,s,255,c,a,1,15|t,19,15,Press 'C' to uplink.|t,5,15,Press 'X' to bomb.|t,12,5,Hold 'Z' to lazer.|g,11,316,2|c,20,305,10,lazer|g,22,326,2|g,9,345,2|g,13,355,2|g,22,366,2|g,14,380,2|g,20,380,1|c,25,384,10,hp|u,19,366,4|u,16,355,4|u,12,345,4|u,14,376,5|g,8,400,2|g,22,410,2|g,10,424,2|g,21,441,2|g,8,464,2|g,11,486,2|u,26,400,4|u,9,411,4|u,18,429,4|u,11,441,4|u,12,463,4|u,20,463,4|u,9,496,4|c,5,509,10,hp|c,10,512,10,2x|c,16,509,10,hp|c,21,512,10,coin5|p,525,10|g,24,464,1|p,475,20|s,315,l,a,1,21|s,333,c,a,1,25|s,350,a,a,2,25|s,369,a,a,1,20|p,390,15|s,388,c,a,2,10|w,388,5,s,388,a,a,1,25|s,400,c,a,2,10|s,417,l,a,2,25|s,441,r,a,2,15|s,473,a,a,2,25|w,473,5,s,473,r,a,1,15|w,473,5,s,473,l,a,1,15|w,473,15,s,473,r,a,2,10|w,486,10,s,486,c,a,2,15|w,496,10,s,496,c,a,2,15|p,18,12|c,9,14,5,coin3|g,28,593,2|g,4,787,3|g,15,783,2|g,27,787,3|u,4,776,5|u,10,749,5|u,8,759,5|u,8,707,5|u,25,654,5|u,15,560,5|c,20,560,8,lazer|c,28,589,8,2x|c,16,602,10,coin6|c,4,621,8,hp|g,16,598,3|g,4,656,3|g,8,669,3|u,25,618,5|u,7,634,5|u,12,685,5|g,27,692,3|c,29,682,10,coin4|c,19,696,10,coin4|c,3,692,10,2x|u,25,704,5|g,19,715,2|g,2,720,2|g,3,739,2|g,9,744,2|u,15,776,5|p,794,45|s,577,a,a,3,8|s,590,a,a,4,6|s,604,l,a,2,12|s,622,c,a,4,10|s,650,a,a,3,20|s,671,c,a,4,10|s,696,c,a,4,10|s,731,c,a,4,10|s,756,c,a,4,10|s,768,a,a,4,20|s,619,l,a,3,9|s,676,l,a,3,9|s,708,l,a,3,9|s,744,l,a,3,9|s,634,r,a,3,18|s,688,r,a,3,9|s,731,r,a,3,9|s,756,r,a,3,9|s,791,c,a,3,10|w,791,5,s,791,a,a,4,8|w,791,8,s,791,l,a,4,12|w,791,12,s,791,r,a,4,12|w,790,20,s,790,a,a,3,15|w,791,20,s,791,a,a,3,15|w,790,20,s,790,c,a,4,20|w,791,30,s,791,c,a,4,35|u,27,776,5|s,685,a,a,4,15|s,662,a,a,4,15",function(){let t=window.app.display,e=window.app.terrain={},s=e.tile_width=25,i=e.tile_height=32,r=-6,a=7,h={size:24},l=null,n=function(){return Math.round(t.normalize.apply(null,arguments))},c=123456;function o(){let t=1e4*Math.sin(c++);return t-Math.floor(t)}function p(t){return t[Math.floor(o()*t.length)]}function d(t,e,s){return e*s+t}function u(t,e){return e>=0&&t>=0&&t<32}function f(t,e,s,i){let r=d(t,e,32);if(s[r].type===i||t<1||e<1||t>31)return!1;let a=s[r+1],h=s[r-1];var l=s[r-32],n=s[r+32];return!(!a||a.type!==i)||(!(!h||h.type!==i)||(!(!l||l.type!==i)||!(!n||n.type!==i)))}let x={none:{ch:" ",fg:["#FFF"],bg:["#000"]},trees:{ch:" ",fg:["#373","#363"],bg:["#031","#040","#121"]},grass:{ch:" ",fg:["#3A3","#5D5"],bg:["#464","#252","#151"]},dirt:{ch:".,,\"`'",fg:["#3DD","#394"],bg:["#584","#871","#662"]},mtn:{ch:"/\\^#",fg:["#773"],bg:["#330"]},mtn2:{ch:"  ^",fg:["#98A"],bg:["#546","#557"]},water:{ch:"~ ",fg:["#3FF","#4FF"],bg:["#005","#004"]},shore:{ch:"  _.",fg:["#EB8"],bg:["#765","#764","#775"]},rock:{ch:"~.",fg:["#F22","#F33","#F44"],bg:["#111","#112","#122","#222"]},lava:{ch:"~*  ",fg:["#F82","#FA3"],bg:["#611","#511"]},lavashore:{ch:"  _.",fg:["#CB8"],bg:["#755","#855"]},wall:{ch:"#@",fg:["#111","#222"],bg:["#622","#722","#822"]}};function y(t,e,s){let i=x[t];return{type:t,x:e,y:s,ch:p(i.ch),fg:p(i.fg),bg:p(i.bg),ref:i}}function m(t,e,s,i){let r=n(o(),0,1,8,15);for(let a=e;a<r+e;a++)for(let h=t;h<r+t;h++){if(!u(h,a))continue;let l=!1;i[d(h,a,32)]=y(p(s),h,a);let c=n(o(),0,1,1,4),f={x:0,y:0};if(a===e?(f.y=-1,l=!0):h===t?(f.x=-1,l=!0):h===t-1+r?(f.x=1,l=!0):a===e-1+r&&(f.y=1,l=!0),l)for(let t=1;t<=c;t++){let e=h+t*f.x,r=a+t*f.y;u(e,r)&&(i[d(e,r,32)]=y(p(s),e,r))}}}function w(t,e,s,i,r){m(t,e,[s],r),function(t,e,s,i,r){for(let t=e-32;t<e+32;t++)if(!(t<0))for(let e=0;e<32;e++)f(e,t,r,s)&&(r[d(e,t,32)]=y(i,e,t))}(0,e,s,i,r)}function g(t,e){let s=d(0,t,32);for(let i=0;i<32;i++)e[i+s]=y("wall",i,t),e[i-32+s]=y("wall",i,t-1),e[i+32+s]=y("wall",i,t+1)}e.set=function(){let c=function(t,e){let s=[];for(let i=0;i<t;i++)for(let t=0;t<e;t++)s.push(y("none",t,i));for(let t=0;t<266;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=y(o()>.5?"trees":"grass",i,t);for(let t=266;t<533;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=y("trees",i,t);for(let t=533;t<800;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=y("rock",i,t);for(let t=0;t<6;t++)m(n(o(),0,1,0,31),n(o(),0,1,50,266),["dirt"],s);for(let t=0;t<24;t++)m(n(o(),0,1,0,31),n(o(),0,1,50,400),["mtn"],s);for(let t=0;t<20;t++)w(n(o(),0,1,0,31),n(o(),0,1,50,400),"water","shore",s);for(let t=0;t<10;t++)m(n(o(),0,1,0,31),n(o(),0,1,50,400),["trees"],s);for(let t=0;t<10;t++)m(n(o(),0,1,0,5),n(o(),0,1,0,266),["grass"],s);for(let t=0;t<40;t++)m(n(o(),0,1,0,20),n(o(),0,1,266,533),["mtn","mtn2"],s);for(let t=0;t<20;t++)m(n(o(),0,1,0,20),n(o(),0,1,420,800),["mtn2"],s);for(let t=0;t<30;t++)w(n(o(),0,1,0,25),n(o(),0,1,566,770),"lava","lavashore",s);return g(0,s),g(276,s),g(533,s),s}(800,32),u=l=document.createElement("canvas");u.width=32*s,u.height=800*i,t.setCanv(u),c.forEach(e=>{!function(e,l){let n=Math.floor,c=e.x*s+s/2,d=l.height-i-e.y*i+i/2;if(t.ctx.save(),t.rect({x:c,y:d,w:s,h:i,color:e.bg}),"grass"===e.type||"trees"===e.type||e.type.indexOf("rock")>-1){let r=1+Math.floor(5*o());for(let a=0;a<r;a++){let r=c+n(o()*s),a=d+n(o()*i),h=n(o()*s);t.circle({x:r,y:a,r:h,color:p(e.ref.bg)})}}t.ctx.restore(),h.color=e.fg,t.drawText(e.ch,c+r,d+a,h)}(e,u)}),t.restoreCanv(),e.height=u.height},e.getYOffset=function(e){return-l.height+t.height+e},e.draw=function(s){t.ctx.drawImage(l,0,e.getYOffset(s))}}(),function(){let t=window.app.display,e=t.createSprite.bind(t),s=function({c:t,x:e,y:s,w:i,h:r,rot:a,o:h}){return{type:"rect",c:t||"red",w:i||25,h:r||32,x:e||0,y:s||0,rot:a,outline:h}},i=function({c:t,r:e,x:s,y:i}){return{type:"circle",c:t||"rgba(220,220,220,1.0)",r:e||2,x:s||0,y:i||0}},r=[{c:"#111",w:32,h:32,rot:45},{c:"#44F",w:30,h:30,rot:45},{c:"#0AF",w:15,h:15,rot:45},{c:"#111",w:15,h:15,y:20,x:20},{c:"#44F",w:15,h:15,y:20,x:20},{c:"#77A",w:6,h:30,y:0,x:20},{c:"#111",w:15,h:15,y:20,x:-20},{c:"#44F",w:15,h:15,y:20,x:-20},{c:"#77A",w:6,h:30,y:0,x:-20}],a=[{w:40,h:40,rot:0},{w:40,h:40,rot:22.5},{w:40,h:40,rot:30},{w:40,h:40,rot:45},{w:40,h:40,rot:60},{w:40,h:40,rot:67.5},{w:20,h:20},{w:10,h:10,rot:45}],h=[s({}),s({w:50,h:64}),s({}),s({x:-25}),s({x:25}),s({y:-32}),s({y:32})],l=[{type:"circle",r:27},{type:"circle",r:25},{type:"circle",r:21},{type:"circle",r:15},{type:"circle",r:9},{w:5,h:10}],n=window.app.sprites={air_sz:40,pl_sz:35,get:function(t,e){let s="air"===t?a:"ground"===t?h:"cache"===t?l:[];return JSON.parse(JSON.stringify(s)).map((t,s)=>(t.c=e[s],t))},createSprites(){let t=[];for(let e=0;e<20;e++)t.push("#FFF");function a(t){return`rgba(220,220,220,${t})`}e("none",0,[i({r:10})],9,9),e("expl0",5,[i({r:2})],99,99),e("expl1",5,[i({r:15})],99,99),e("expl2",5,[i({r:30})],99,99),e("expl3",5,[i({r:38,c:a(.6)})],99,99),e("expl4",5,[i({r:40,c:a(.3)})],99,99),e("expl5",5,[i({r:1,c:a(.8)})],99,99),e("expl6",5,[i({r:8,c:a(.8)})],99,99),e("expl7",5,[i({r:15,c:a(.8)})],99,99),e("expl8",5,[i({r:19,c:a(.6)})],99,99),e("expl9",5,[i({r:20,c:a(.3)})],99,99),e("expl10",5,[i({r:2,c:"#FF0"})],25,25),e("expl11",5,[i({r:10,c:"#FF0"})],25,25),e("expl12",5,[i({r:12,c:"#FF0"})],25,25),e("air1",2,n.get("air",["#077","","","#084","","","#0DD",""]),80,80),e("air2",2,n.get("air",["#630","","#930","","#A30","","#A90",""]),80,80),e("air3",3,n.get("air",["#7803C4","","#9720D2","","#B73DE0","","#D75AEE","#F777FD"]),80,80),e("air4",4,n.get("air",["#444","#444","","#444","","#444","#777","#999"]),80,80);for(let s=1;s<=4;s++)e(`air${s}dmg`,2,n.get("air",t),80,80);e("ground1",0,n.get("ground",["#BBB","#981","#666","#878","#878","#878","#878"]),75,96),e("ground2",0,n.get("ground",["#BBB","#666","#999","#999","#999","#999","#878"]),75,96),e("ground3",0,n.get("ground",["#BBB","#666","#999","#999","#999","#999","#878"]),75,96);for(let s=1;s<=3;s++)e(`ground${s}dmg`,0,n.get("ground",t),75,96);e("grounddead",0,n.get("ground",["#111","#222","#333","#676","#565","#676","#454"]),75,96),e("turret1",0,[s({c:"#333",w:12,h:30}),s({c:"#981",w:16,h:16,y:-15})],75,96),e("turret2",0,[s({c:"#333",w:8,h:30,x:-5}),s({c:"#333",w:8,h:30,x:5})],75,96),e("turret3",0,[s({c:"#333",w:5,h:30,x:-6}),s({c:"#333",w:5,h:30}),s({c:"#333",w:5,h:30,x:6})],75,96),e("lazer1",0,[{c:"#FFF",w:4,h:14}],4,20),e("lazer2",0,[{c:"#0FF",w:4,h:20},{c:"#FFF",w:2,h:16}],4,20),e("lazer3",0,[{c:"#FF0",r:4},{type:"circle",c:"#FFF",r:3}],12,12),e("bomb1",0,[{type:"circle",c:"#4AA",r:7},{type:"circle",c:"#0FF",r:5},{type:"circle",c:"#FFF",r:2}],14,14),e("bullet1",0,[{type:"circle",c:"#900",r:7},{type:"circle",c:"#F88",r:5}],12,12),e("bullet2",0,[{type:"circle",c:"#990",r:8},{type:"circle",c:"#FF8",r:6}],14,14),e("bullet3",0,[{type:"circle",c:"#909",r:9},{type:"circle",c:"#F8F",r:7}],12,12);const h=["#111","#555","#344","#466","#599","#FF1","#3A5","#3A5","#3A5","#3A5"];e("cache0",0,n.get("cache",h),65,65);const l=h.slice();l[2]="#354",l[3]="#476",l[4]="#6A9",e("cache1",0,n.get("cache",l),65,65);const c=h.slice();c[2]="#355",c[3]="#486",c[4]="#6AA",e("cache2",0,n.get("cache",c),65,65);const o=h.slice();o[1]="#111",o[2]="#111",o[3]="#222",o[4]="#222",o[5]="#111",e("cachedead",0,n.get("cache",o),65,65),e("cachedmg",0,n.get("cache",t),65,65),e("flash1",0,[{c:"#FFF",rot:45,w:2,h:12,y:-10},{c:"#FFF",rot:-45,w:2,h:12,y:-10}],50,50),e("target",0,[{c:"#0F0",rot:45,w:2,h:18},{c:"#0F0",rot:-45,w:2,h:18}],50,50),e("pwrhp",0,[i({r:18,c:"#111"}),i({r:16,c:"#55F"}),s({x:-6,w:10,h:4,c:"#FFF"}),s({x:-11,w:4,h:14,c:"#FFF"}),s({x:-1,w:4,h:14,c:"#FFF"}),s({x:5,w:4,h:14,c:"#FFF"}),i({x:10,y:-2,r:5,c:"#FFF"}),i({x:10,y:-2,r:2,c:"#111"})],99,99),e("pwrlazer",0,[i({r:22,c:"#EEE"}),i({r:20,c:"#F92"}),s({w:6,h:20,c:"#FFF"}),s({w:20,h:5,c:"#FFF"})],99,99),e("pc0",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"})],99,99),e("pc1",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"}),s({x:-3,y:-2,w:3,h:1,c:"#FFF",o:0}),s({x:-3,y:-2,w:2,h:3,c:"#FFF",o:0})],99,99),e("pc2",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"}),s({x:-3,y:-2,w:8,h:1,c:"#FFF",o:0}),s({x:-3,y:-2,w:1,h:8,c:"#FFF",o:0})],99,99),e("pwr2x",0,[s({rot:45,w:8,h:30,c:"#F2F"}),s({rot:-45,w:8,h:30,c:"#F2F"})],99,99),e("harpoon",0,[s({x:-5,y:10,w:4,h:20,c:"#888"}),s({x:5,y:10,w:4,h:20,c:"#888"}),s({w:20,h:4,c:"#888"})],99,99),e("plug0",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AAA"}),s({x:10,y:-12,w:4,h:25,c:"#AAA"}),s({w:30,h:4,c:"#AAA"})],99,99),e("plug1",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AAF"}),s({x:10,y:-12,w:4,h:25,c:"#AAF"}),s({w:30,h:4,c:"#ABB"})],99,99),e("plug2",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AFF"}),s({x:10,y:-12,w:4,h:25,c:"#AFF"}),s({w:30,h:4,c:"#AEE"})],99,99),e("plug4",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#777"}),s({x:10,y:-12,w:4,h:25,c:"#777"}),s({w:30,h:4,c:"#777"})],99,99);let p=t=>{let e=JSON.parse(JSON.stringify(r));for(let s=3;s<9;s++)e[s].x=e[s].x/t;return e[2].w/=t,e[2].h/=t,e=[e[6],e[7],e[8]].concat([e[0],e[1],e[2],e[3],e[4],e[5]])};e("p4",0,p(-2),200,200),e("p3",0,p(-1.5),200,200),e("p2",0,r,200,200),e("p1",0,p(1.5),200,200),e("p0",0,p(2),200,200)}}}(),function(){let t,e=window.app.display,s=window.app.sprites,i=window.app.terrain,r=localStorage,a=e.height,h=e.width,l=e.drawText,n=.9,c=parseInt,o=t=>`rgba(0,0,0,${t})`;function p(t,e){return t<e||t>360-e&&t<360}class d{constructor(t){this.f=0,this.name=t,this.speed=6,this.mxsd=4,this.x=0,this.y=0,this.r=10,this.w=10,this.h=10,this.vx=0,this.vy=0,this.ax=0,this.hp=1,this.max_ax=1,this.accel=.2,this.deccel=.05,this.hed=0,this.isac=!1,this.remv=!1,this.state="",this.expl="expl_air",this.anim=null,this.sprite=null,this.ai=function(){}}setState(t){this.state!==t&&(this.state=t,this.anim=e.getAnim(this.name+"_"+t))}getHedTo({x:t,y:e}){let s=e-this.y,i=t-this.x,r=Math.sqrt(i*i+s*s),a=0;return(a=e>=this.y&&t>=this.x?180*Math.asin(s/r)/Math.PI+90:e>=this.y&&t<this.x?180*Math.asin(s/-r)/Math.PI-90:e<this.y&&t>this.x?180*Math.asin(s/r)/Math.PI+90:180*Math.asin(-s/r)/Math.PI-90)>=360&&(a=360-a),a<0&&(a=360+a),a}pointAt({x:t,y:e}){this.hed=this.getHedTo({x:t,y:e})}turn(t){this.ax="left"===t?-this.max_ax:this.max_ax}turnTowards({x:t,y:e}){let s=this.getHedTo({x:t,y:e});this.hed<=s?Math.abs(this.hed-s)<180?this.turn("right"):this.turn("left"):Math.abs(this.hed-s)<180?this.turn("left"):this.turn("right")}acc(){let{x:t,y:s}=e.hedToVec(this.hed,this.mxsd);this.vx<t?this.vx+=this.accel:this.vx>t&&(this.vx-=this.accel),this.vy<s?this.vy+=this.accel:this.vy>s&&(this.vy-=this.accel),this.isac=!0}decc(){this.vx<0?this.vx+=this.deccel:this.vx>0&&(this.vx-=this.deccel),this.vy<0?this.vy+=this.deccel:this.vy>0&&(this.vy-=this.deccel),Math.abs(this.vx)<.001&&(this.vx=0),Math.abs(this.vy)<.001&&(this.vy=0)}coll({x:s,y:i,r:r}){if(t.ncontrol)return!1;let a=e.distance(s,i,this.x,this.y);if(a<r+this.r&&!this.remv){return{x:this.x-s,y:this.y-i,d:a}}}explode(){this.remv=!0,this.expl&&t.addPar(this.expl,this.x,this.y)}fire(s,i,r){let a=()=>{let s=this.hed-20+40*Math.random(),r=new t.Bullet(i,s),{x:a,y:h}=e.hedToVec(this.hed,25);r.x=this.x+a,r.y=this.y+h,t.actors.push(r),t.addPar("flash",r.x,r.y).hed=this.hed,e.playSound("bullet")};for(let e=0;e<r;e++)t.setCB(a,5*e+1,!0)}damage(t){return this.hp-=t,this.hp<=0&&(this.explode(),!0)}update(){this.ai&&!t.ncontrol&&this.ai(),this.x+=this.vx,this.y+=this.vy,this.hed+=this.ax,this.hed>=360&&(this.hed=this.hed-360),this.hed<0&&(this.hed=360+this.hed),this.ax=0,this.isac||this.decc(),this.isac=!1,this.f++}draw(){this.anim?e.drawAnim(this.anim,this.x,this.y,1,this.hed):this.sprite&&e.drawSprite(this.sprite,this.x,this.y)}}class u extends d{constructor(s){super(s),this.sprite=s,this.expl="expl_air",this.level=parseInt(s.slice(-1)),this.dmg=[0,3,5,8,10][this.level],this.mxsd=[0,4,5,6,7][this.level],this.hp=[0,1,5,15,20][this.level],this.max_ax=[0,1,1,1.5,2][this.level],this.ai=(()=>{let s=t.player;if(this.f>420)this.hed=180,this.acc();else if(this.f>540)this.explode();else if(this.y>200){if(this.turnTowards(s),e.distance(this.x,this.y,s.x,s.y)>40){p(Math.abs(this.hed-this.getHedTo(s)),90)&&this.acc()}}else this.acc()})}damage(s){super.damage(s),this.anim=e.getAnim(this.name+"dmg"),t.setCB(()=>{this.is_dead||(this.anim=e.getAnim(this.name))},6,!0)}explode(){super.explode(),e.playSound("expa"),t.addPoints(50*this.level)}update(){super.update();let i=t.player;this.coll({x:i.x,y:i.y,r:s.pl_sz})&&(e.playSound("hit"),this.explode(),t.player.damage(this.dmg))}}class f extends d{constructor(t,s,i){super(t),this.tx=s,this.ty=i,this.w=75,this.h=96,this.x=25*s,this.r=this.w/2,this.sprite=t,this.level=parseInt(t.slice(-1)),this.deadsprite="grounddead",this.anim=e.getAnim(t),this.max_ax=2,this.is_dead=!1}explode(){for(let e=0;e<5;e++)t.addPar(this.expl,this.x-25+50*Math.random(),this.y-25+50*Math.random());this.anim=e.getAnim(this.deadsprite),this.is_dead=!0}damage(s){super.damage(s),this.is_dead||(this.anim=e.getAnim(this.name+"dmg"),t.setCB(()=>{this.is_dead||(this.anim=e.getAnim(this.name))},6,!0))}getY(){return 32*(800-this.ty)+i.getYOffset(t.tyoff)}isVisible(){let t=this.getY();return t>=-100&&t<=a+100}update(){this.y=this.getY(),super.update()}draw(){if(this.isVisible()){let t=this.getY(),s=25*this.tx;e.drawAnim(this.anim,s,t),!this.is_dead&&this.turret_anim&&e.drawAnim(this.turret_anim,s,t,1,this.hed)}}}class x extends f{constructor(s,i,r){super(s,i,r),this.turret_anim=e.getAnim("turret"+this.level),this.hp=[0,6,12,16][this.level],this.fire_rate=[0,170,130,100][this.level],this.ai=(()=>{let s=t.player;if(!this.is_dead&&this.getY()>50&&this.getY()<a){this.turnTowards(s),p(Math.abs(this.hed-this.getHedTo(s)),25)&&e.frame%this.fire_rate==0&&this.fire("bullet",this.level,8)}})}explode(){super.explode(),t.ncontrol||e.playSound("expg"),t.addPoints(200*this.level)}}class y extends f{constructor(t,e,s,i){super("cache",t,e),this.hp=s,this.deadsprite="cachedead",this.wh=i}explode(){if(super.explode(),"hp"===this.wh)t.addPowerup("hp",this.x,this.y,0,1);else if(this.wh.indexOf("coin")>-1){let e=parseInt(this.wh.slice(4));for(let s=0;s<e;s++)t.addPowerup("coin",this.x,this.y,6*Math.random()-3,6*Math.random()-3)}else"lazer"===this.wh?t.addPowerup("lazer",this.x,this.y,0,1):"2x"===this.wh&&t.addPowerup("2x",this.x,this.y,0,1);t.addPoints(100)}}class m extends f{constructor(t){super("none",10,t),this.loc="c",this.level=1,this.amt=5,this.wait=0,this.pause_seconds=0,this.begin_level=0,this.end_level=0}update(){if(this.isVisible())if(this.remv=!0,this.pause_seconds)t.tss=0,t.setCB(()=>{t.tss=n},60*this.pause_seconds,!0);else if(this.wait)t.setCB(()=>{for(let e=0;e<this.amt;e++)t.spawns.push(this.loc+",air"+this.level)},60*this.wait,!0);else if(this.end_level)t.endLevel();else for(let e=0;e<this.amt;e++)t.spawns.push(this.loc+",air"+this.level)}draw(){}}class w extends f{constructor(t,s,i,r){super(t+"1",s,i),this.anim=e.getAnim("plug"),this.deadanim=e.getAnim("plugdead"),this.r=25,this.nframes=60*r,this.ai=function(){}}draw(){if(this.isVisible()){let t=this.getY(),s=25*this.tx;this.is_dead?e.drawAnim(this.deadanim,s,t):e.drawAnim(this.anim,s,t)}}}class g extends d{constructor(t,s,i){super("p"),this.x=s,this.y=i,this.anim=e.getAnim(t)}update(){super.update(),this.anim.is_done&&(this.remv=!0)}}class v extends g{constructor(t,e,s,i){super("expl_air",e,s),this.text=t,this.vy=-1,this.color="#FFF",this.deccel=0,this.max_frames=60,this.is_ground=i||!1,this.size=30,i&&(this.size=20,this.vy=0)}update(){super.update(),this.is_ground?(this.y+=t.tss,this.y>a&&(this.remv=!0)):this.f>this.max_frames&&(this.remv=!0)}draw(){l(this.text,this.x,this.y,{size:this.size,color:this.color})}}t={keys:{},cbs:[],cbs_pll:[],high_score:r&&r.getItem("score")||0,score:0,smult:1,init(){a=e.height,h=e.width,t.paused=!0,t.setEvents(),e.clearScreen(),e.setLoop(t.loop)},start(){e.playSound("lvlstart"),t.loading=!0,setTimeout(()=>{t.loading=!1,t.started=!0,t.paused=!1,t.scrolling=!0,t.lvln=1,t.actors=[],t.spawns=[],t.createObjects(),t.player=new class extends d{constructor(){super("player"),this.x=400,this.y=400,this.r=25,this.max_target_y=-150,this.target_y=-150,this.setState("default"),this.lzrcd=20,this.lzfrm=20,this.lzlvl=1,this.max_hp=100,this.hp=this.max_hp,this.uplink=null,this.bombs=[],this.bomb_frame=0}lazer(){if(this.lzfrm>this.lzrcd)if(this.lzfrm=0,1===this.lzlvl)for(let e=0;e<3;e++){let s=new t.Lazer(1,!0),i=new t.Lazer(1);s.vy=i.vy=-9,s.damage=i.damage=1,s.delay=i.delay=3*e,s.x_offset=-5,i.x_offset=5,t.actors.push(s,i)}else if(2===this.lzlvl)for(let e=0;e<4;e++)for(let s=-10;s<=10;s+=10){let i=new t.Lazer(2,-10===s);i.vy=-14,i.damage=3,i.delay=3*e,i.x_offset=s,t.actors.push(i)}else if(3===this.lzlvl)for(let s=0;s<4;s++)for(let i=1;i<6;i++){let r=new t.Lazer(3,1===i);r.vx=e.normalize(i,0,6,-3,3),r.delay=3*s,r.damage=5,r.x_offset=r.vx,t.actors.push(r)}}bomb(){if(0===this.bombs.length){let e=[0,1,2,4][t.lvln];for(let s=0;s<e;s++){let e=new t.Bomb(1,this.x,this.y,this.target_y);this.bombs.push(e)}}}harpoon(){if(!this.uplink){let s=new t.Harpoon(1,this.x,this.y);this.uplink=s,e.playSound("harpoon"),t.actors.push(s)}}explode(){t.ncontrol||(e.playSound("lvlfail"),t.end())}update(){let s=!1;t.keys.arrowleft&&(s=!0,this.x-=this.speed),t.keys.arrowright&&(s=!0,this.x+=this.speed),t.keys.arrowup&&(this.y-=this.speed),t.keys.arrowdown?this.y+=this.speed:(this.target_y-=4,this.target_y<this.max_target_y&&(this.target_y=this.max_target_y)),t.keys.z&&this.lazer(),s||"left"!==this.state&&"right"!==this.state||("left"===this.state?this.setState("from_left"):this.setState("from_right")),this.x<0?this.x=0:this.x>h?this.x=h:this.y<0?this.y=0:this.y>a&&(this.y=a,t.keys.arrowdown&&(this.target_y+=4,this.target_y>0&&(this.target_y=0))),this.lzfrm++,this.uplink&&this.uplink.remv&&(this.uplink=null),this.bombs.length&&(this.bomb_frame<=0?(this.bomb_frame=4,e.playSound("bomb"),t.actors.push(this.bombs.shift())):this.bomb_frame--)}draw(){super.draw(),e.drawSprite("target",this.x,this.y+this.target_y);let t=e.normalize(this.hp,0,this.max_hp,0,160),s=a-10-2,i=h-160+80-20,r=h-160+t/2-20;e.rect({x:i,y:s,w:160,h:10,color:"red",outline:!0}),e.rect({x:r,y:s,w:t,h:10,color:"blue",outline:!0});let n=Math.round(100*this.hp/this.max_hp)+"%";l(n,i-6.5*n.length,s+2,{size:24,color:"white"})}},t.score=0,t.smult=1,t.spawn_frame=0,t.tss=n,t.camToLvl(t.lvln),t.fade(!0)},100)},camToLvl(e){let s=t.actors.reduce((t,s)=>t||(s instanceof m&&s.begin_level===e+""?s:null),null);t.tyoff=32*s.y},end(s){t.cbs=[],t.cbs_pll=[],t.ncontrol=!0;let i=Math.random,a=t.player;if(s)e.playSound("lvlcomplete"),t.actors.forEach(t=>{t instanceof x&&t.explode()}),t.vic=!0,t.setCB(function(){},60);else for(let e=0;e<8;e++)t.addPar("expl_air",a.x-25+50*i(),a.y-25+50*i());t.fade(!1),t.score>t.high_score&&(e.playSound("beaconupload"),t.high_score=t.score,r&&r.setItem("score",t.score),t.hs=!0),t.setCB(()=>{t.hs=!1,t.ncontrol=!1,t.started=!1,t.vic=!1},60)},endLevel(){t.tss=0;for(let s=0;s<5;s++)t.setCB(()=>{e.playSound("lvlcomplete")},10);t.fade(!1),3!==t.lvln?t.setCB(()=>{t.lvln++,t.fade(!0),t.camToLvl(t.lvln),t.tss=n,e.playSound("lvlstart")},300):t.end(!0)},fade(e){for(let s=0;s<10;s++)e&&(t.fopac=1),t.setCB(()=>{t.fopac=e?Number(((9-s)/9).toFixed(1)):Number((s/9).toFixed(1))},8)},loop:()=>t.paused?(e.clearScreen(),void t.draw()):!t.ncontrol||t.ncontrol&&e.frame%3==0?(t.update(),e.clearScreen(),void t.draw()):void 0,update(){if(this.cbs.length){let t=this.cbs[0];t.current_frame++,t.current_frame>=t.max_frames&&(t.cb(),this.cbs.shift())}if(this.cbs_pll=this.cbs_pll.filter(t=>(t.current_frame++,!(t.current_frame>=t.max_frames)||(t.cb(),!1))),t.started){t.player.update();for(let e=0;e<t.actors.length;e++){let s=t.actors[e];s.update(),s.remv&&(t.actors.splice(e,1),e--)}t.spawn(),t.scrolling&&(t.tyoff+=t.tss,t.tyoff>i.height-a&&(t.tyoff=i.height-a))}},draw(){if(!t.loading){if(!t.started){let e="High Score "+t.high_score;return l(e,50,50,{size:25,color:"gold"}),l("PLANET: OFFLINE",222,400,{size:42,color:"white"}),void l("Press any key to start.",222,600,{size:28,color:"white"})}i.draw(t.tyoff);for(let e=0;e<t.actors.length;e++){t.actors[e].draw()}t.fopac&&e.rect({x:400,y:400,w:800,h:800,color:o(t.fopac)}),t.hs&&l("NEW HIGH SCORE!",220,120+3*Math.random(),{size:42,color:"cyan"}),t.vic&&l("VICTORY!",307,220+3*Math.random(),{size:42,color:"green"}),t.ncontrol||t.player.draw(),l('ESC to pause, "m" to mute',20,20,{size:16}),l("SCORE: "+t.score+" x"+t.smult,h-260,20,{size:16}),t.paused&&(e.rect({x:400,y:400,w:800,h:800,color:o(.3)}),l("PAUSED",356,400,{size:28}),l("ESC to unpause",341,450,{size:16}))}},spawn(){if(0!==t.spawns.length)if(t.spawn_frame>=10){let s=t.spawns.shift(),i=s.split(",")[0],r=s.split(",")[1],a=new u(r);a.y=-20,a.vy=2,a.hed=180;let l=h/2-100,n=h/2+100;"l"===i?(l=25,n=226):"r"===i?(l=h-225,n=h-25):"a"===i&&(l=50,n=750),a.x=e.randbtwn(l,n),t.actors.push(a),t.spawn_frame=0}else t.spawn_frame++;else t.spawn_frame=0},setCB(t,e,s){(s?this.cbs_pll:this.cbs).push({cb:t,max_frames:e,current_frame:0})},addPar(e,s,i,r){let a=new(r?class extends g{constructor(t,e,s){super(t,e,s)}update(){super.update(),this.y+=t.tss}}:g)(e,s,i);return t.actors.push(a),a},addText(e,s){s=s||"#FFF";let i=new v(e,h/2-7*e.length,90);return i.color=s,t.actors.push(i),i},addPowerup(s,i,r,a,h){let l=new class extends d{constructor(s,i,r,a,h){super("pwr"+s),this.x=i,this.y=r,this.vx=a,this.vy=h,this.anim=e.getAnim("pwr"+s),this.max_frames=360,this.accel=.2,this.max_ax=3,this.mxsd=8,this.r=15,this.ai=(()=>{let s=t.player;if(e.distance(this.x,this.y,s.x,s.y)<100)return this.pointAt(s),void this.acc();"pwrhp"!==this.name&&"pwrlazer"!==this.name&&"pwr2x"!==this.name||(this.turn("left"),Math.random()>.5&&this.acc())})}update(){super.update(),this.f===this.max_frames&&(this.remv=!0),this.coll(t.player)&&(this.remv=!0,"pwrhp"===this.name&&(t.player.hp+=.5*t.player.max_hp,t.player.hp>t.player.max_hp&&(t.player.hp=t.player.max_hp),e.playSound("hp")),"pwrlazer"===this.name&&(t.player.lzlvl++,t.player.lzlvl>3&&(t.player.lzlvl=3),e.playSound("special")),"pwrcoin"===this.name&&(t.addPoints(1e3),e.playSound("coin")),"pwr2x"===this.name&&(t.smult*=2,e.playSound("special")))}draw(){if(this.f>this.max_frames/2&&this.f%8<4)return;let t=this.hed;this.hed=0,super.draw(),this.hed=t}}(s,i,r,a,h);this.actors.push(l)},addPoints(e){t.score+=e*t.smult},createObjects(){t.level_frame=0;let e=window.app.level.split("|").map(t=>t.split(","));i.set("main");let s={w:e=>{let s=new m(c(e[1]));s.loc=e[5],s.wait=e[2],s.type=e[6],s.level=e[7],s.amt=e[8],t.actors.push(s)},u:e=>{t.actors.push(new w("plug",c(e[1]),c(e[2]),e[3]))},c:e=>{t.actors.push(new y(e[1],e[2],e[3],e[4]))},p:e=>{let s=new m(c(e[1]));s.pause_seconds=c(e[2]),t.actors.push(s)},s:e=>{let s=new m(c(e[1]));s.loc=e[2],s.type=e[3],s.level=e[4],s.amt=e[5],t.actors.push(s)},g:e=>{t.actors.push(new x("ground"+e[3],e[1],e[2]))},t:e=>{t.actors.push(new v(e[3],25*e[1],32*e[2],!0))},bl:e=>{let s=new m(c(e[1]));s.begin_level=e[2],s.amt=0,s.y=c(e[1]),s.x=0,t.actors.push(s)},sl:e=>{let s=new m(c(e[1]));s.end_level=e[2],t.actors.push(s)}};e.forEach(t=>{s[t[0]](t)})},setEvents(){document.addEventListener("keydown",s=>{let i=s.key.toLowerCase();t.ncontrol||t.keys[i]||(t.keys[i]=!0,t.started?("arrowleft"===i&&t.player.setState("left"),"arrowright"===i&&t.player.setState("right"),"z"===i&&t.player.lazer(),"x"===i&&t.player.bomb(),"c"===i&&t.player.harpoon(),"escape"===i&&(t.paused=!t.paused),"m"===i&&(e.mute=!e.mute)):t.start())}),document.addEventListener("keyup",e=>{t.keys[e.key.toLowerCase()]=!1})}},window.app.game=t,t.Actor=d,t.Bullet=class extends d{constructor(t,s){super("bullet_"+t),this.sprite="bullet"+t,this.hed=s,this.mxsd=4,this.accel=1,this.r=6;let{x:i,y:r}=e.hedToVec(s,this.mxsd);this.vx=i,this.vy=r,this.dmg=1,this.ai=(()=>{this.f>120&&(this.remv=!0)})}update(){this.f++,this.ai(),this.x+=this.vx,this.y+=this.vy,this.coll(t.player)&&(e.playSound("hit"),t.player.damage(this.dmg),this.explode())}},t.Bomb=class extends d{constructor(t,e,s,i){super("bomb_"+t),this.x=e,this.sy=s-20,this.y=s,this.target_y=i,this.sprite="bomb"+t,this.max_frames=40,this.r=7,this.expl="expl_bomb"}explode(){this.remv=!0,t.addPar(this.expl,this.x,this.y,!0)}update(){if(this.y=this.sy+e.normalize(this.f,0,this.max_frames,0,this.target_y)+this.max_frames*t.tss,this.f++,this.f===this.max_frames){for(let s=0;s<t.actors.length;s++){let i=t.actors[s];if((i instanceof x||i instanceof y)&&!i.is_dead&&this.coll(i)){e.playSound("sand"),i.damage(1);break}}e.playSound("bombg"),this.explode()}}},t.Lazer=class extends d{constructor(t,e){super("lazer_"+t),this.damage=1,this.vy=-10,this.vx=0,this.delaying=!0,this.delay=0,this.x_offset=0,this.sprite="lazer"+t,this.expl="expl_lazer",this.sound=e}update(){if(this.f++,this.delaying&&this.f>this.delay){const{x:s,y:i}=t.player;this.delaying=!1,this.x=s+this.x_offset,this.y=i,this.sound&&e.playSound("lazer1")}this.y+=this.vy,this.x+=this.vx;for(let e=0;e<t.actors.length;e++){let s=t.actors[e];if(s instanceof u&&this.coll(s)){this.explode(),s.damage(this.damage);break}}this.f>180&&(this.remv=!0)}draw(){this.delaying||super.draw()}},t.Harpoon=class extends d{constructor(t,e,s){super("harpoon_"+t),this.x=e,this.y=s,this.sprite="harpoon",this.max_frames=40,this.r=7,this.vy=5,this.expl="expl_bomb",this.connected=!1,this.upload_frames=120,this.maxdist=300,this.plug=null}update(){let s=t.player;if(this.f++,this.y+=this.vy,this.x+=this.vx,this.f===this.max_frames)return this.connected&&(e.playSound("upl"),t.addText("Upload success!","#5E5"),this.plug.is_dead=!0,t.addPoints(5e3)),void this.explode();if(this.connected){this.y+=t.tss;let i=e.distance(this.x,this.y,s.x,s.y);this.f%20==0&&e.playSound("blip"),i>this.maxdist&&(e.playSound("uplf"),this.explode(),t.addText("Disconnect!","#E55"))}else for(let e=0;e<t.actors.length;e++){let s=t.actors[e];if(s instanceof w&&!s.is_dead&&this.coll(s)){t.addText("Uploading..."),this.connected=!0,this.vx=this.vy=this.f=0,this.x=s.x,this.y=s.y,this.max_frames=s.nframes,this.plug=s;break}}}draw(){const{x:s,y:i}=t.player;e.drawSprite(this.sprite,this.x,this.y),e.line({x:this.x,y:this.y,x2:s,y2:i,color:"#EEE"}),this.connected&&(e.line({x:this.x+3,y:this.y,x2:s,y2:i,color:"#AAF"}),e.line({x:this.x-3,y:this.y,x2:s,y2:i,color:"#AAF"}),this.f%10<5&&e.line({x:this.x,y:this.y,x2:s,y2:i,color:"#333"}),e.circle({x:this.x,y:this.y,r:this.maxdist,color:"#FFF",o:1}))}}}();