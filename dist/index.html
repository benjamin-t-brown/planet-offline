<html><head><style>body{margin:0px;overflow:hidden;background-color:gray;}canvas{display:block;margin:0 auto;position:fixed;height:100%;transform:translate(-50%,-50%);left:50%;top:50%}</style></head>
<body><canvas id="c" width="800" height="800"></canvas></body>
<footer><script>app={};</script><script>
!function(){var t=new function(){var t,e,s,i,h,r,a,l,c,n,o,p;this._params=new function(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}},this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),h=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,a=-t.i*t.i*t.i*1e-6,t.a||(o=.5-t.n/2,p=5e-5*-t.o),l=1+t.l*t.l*(t.l>0?-.9:10),c=0,n=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return t=i.b*i.b*1e5,e=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((t+e+s)/3|0)},this.synthWave=function(d,u){var f=this._params,x=1!=f.s||f.v,w=f.v*f.v*.1,m=1+3e-4*f.w,g=f.s*f.s*f.s*.1,y=1+1e-4*f.t,v=1!=f.s,b=f.x*f.x,F=f.g,A=f.q||f.r,z=f.r*f.r*f.r*.2,_=f.q*f.q*(f.q<0?-1020:1020),S=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,k=f.d,M=f.j/2,C=f.k*f.k*.01,E=f.a,P=t,B=1/t,T=1/e,I=1/s,L=5/(1+f.u*f.u*20)*(.01+g);L>.8&&(L=.8),L=1-L;for(var O,H,D,Y,q,N,R=!1,V=0,$=0,j=0,U=0,W=0,J=0,G=0,K=0,Q=0,X=0,Z=new Array(1024),tt=new Array(32),et=Z.length;et--;)Z[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<u;et++){if(R)return et;if(S&&++Q>=S&&(Q=0,this.reset()),n&&++c>=n&&(n=0,i*=l),(i*=r+=a)>h&&(i=h,F>0&&(R=!0)),H=i,M>0&&(X+=C,H*=1+Math.sin(X)*M),(H|=0)<8&&(H=8),E||((o+=p)<0?o=0:o>.5&&(o=.5)),++$>P)switch($=0,++V){case 1:P=e;break;case 2:P=s}switch(V){case 0:j=$*B;break;case 1:j=1+2*(1-$*T)*k;break;case 2:j=1-$*I;break;case 3:j=0,R=!0}A&&((D=0|(_+=z))<0?D=-D:D>1023&&(D=1023)),x&&m&&((w*=m)<1e-5?w=1e-5:w>.1&&(w=.1)),N=0;for(var st=8;st--;){if(++G>=H&&(G%=H,3==E))for(var it=tt.length;it--;)tt[it]=2*Math.random()-1;switch(E){case 0:q=G/H<o?.5:-.5;break;case 1:q=1-G/H*2;break;case 2:q=.225*(((q=1.27323954*(Y=6.28318531*((Y=G/H)>.5?Y-1:Y))+.405284735*Y*Y*(Y<0?1:-1))<0?-1:1)*q*q-q)+q;break;case 3:q=tt[Math.abs(32*G/H|0)]}x&&(O=J,(g*=y)<0?g=0:g>.1&&(g=.1),v?(W+=(q-J)*g,W*=L):(J=q,W=0),U+=(J+=W)-O,q=U*=1-w),A&&(Z[K%1024]=q,q+=Z[(K-D+1024)%1024],K++),N+=q}N*=.125*j*b,d[et]=N>=1?32767:N<=-1?-32768:32767*N|0}return u}},e=function(e){t._params.setSettings(e);var s=t.totalReset(),i=new Uint8Array(4*((s+1)/2|0)+44),h=2*t.synthWave(new Uint16Array(i.buffer,44),s),r=new Uint32Array(i.buffer,0,44);r[0]=1179011410,r[1]=h+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=h,h+=44;for(var a=0,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="data:audio/wav;base64,";a<h;a+=3){var n=i[a]<<16|i[a+1]<<8|i[a+2];c+=l[n>>18]+l[n>>12&63]+l[n>>6&63]+l[63&n]}return c};"function"==typeof require?module.exports=e:this.jsfxr=e}(),function(){let t={canvasid:"c",canvas:null,ctx:null,sprites:{},frame:0,width:800,height:800,mute:!1,sounds:[],animations:{}};class e{constructor(t,e){this.name=t,this.loop=e||!1,this.sprites=[],this.cf=0,this.cfmax=0,this.cind=0,this.is_done=!1}s(t,e){this.sprites.push({max_frames:e,name:t}),1===this.sprites.length&&(this.cfmax=e)}update(){this.cf++,this.cf>=this.cfmax&&(this.cind++,this.cind>=this.sprites.length&&(this.is_done=!0,this.loop?this.cind=0:this.cind--),this.cf=0,this.cfmax=this.sprites[this.cind].max_frames)}getSprite(){return this.sprites[this.cind].name}}t.setCanv=function(e){t.canvas=e,t.ctx=e.getContext("2d")},t.restoreCanv=function(){t.canvasid=t.canvasid,t.canvas=document.getElementById(t.canvasid),t.ctx=t.canvas.getContext("2d"),t.width=t.canvas.width,t.height=t.canvas.height},t.createSprite=function(s,i,h,r,a){let l={name:s,drot:i,shapes:h,w:r,h:a};t.sprites[s]=l,t.rasterize(l),t.cAnim(s,()=>{let t=new e(s,!1);return t.s(s,2),t})},t.cAnim=function(e,s){t.animations[e]=s},t.normalize=function(t,e,s,i,h){return i+(t-e)*(h-i)/(s-e)},t.randbtwn=function(e,s){return Math.round(t.normalize(Math.random(),0,1,e,s))},t.distance=function(t,e,s,i){let h=s-t,r=i-e;return Math.sqrt(h*h+r*r)},t.hedToVec=function(t,e){return{x:e*Math.sin(Math.PI*t/180),y:-e*Math.cos(Math.PI*t/180)}},t.loadSounds=function(){let e=(e,s)=>{let i=window.jsfxr(s),h=[];for(let t=0;t<4;t++){let t=new Audio;t.src=i,h.push(t)}t.sounds[e]={cc:0,cha:h}};e("sand",[3,.13,.26,.95,.35,.37,,.5,,.19,.37,.8799,.35,,,,,,1,-.92,.12,.1614,,.25]),e("bomb",[0,.13,.26,.53,.35,.04,,.5,,.19,.37,.1799,.35,,,.56,-.86,.76,1,.56,.68,.78,-.4599,.25]),e("coin",[0,,.0917,.37,.32,.54,,,,.23,.02,.4813,.65,,,,.8,,1,,.11,,,.25]),e("expa",[3,,.1083,.3869,.3314,.1406,,-.2676,,,,,,,,,.5116,-.2477,1,,,,,.25]),e("expg",[3,,.3646,.7897,.2321,.1281,,-.3439,,,,,,,,,.2502,-.0041,1,,,,,.25]),e("bombg",[3,,.01,.6031,.4332,.027,,.2071,,,,,,,,,,,1,,,,,.25]),e("bullet",[1,.0054,.2302,,.2346,.9064,.1659,-.6154,.0044,.0708,.0179,.0085,.066,.5,-.5604,.0104,.0832,-.0182,.9625,.0138,.1126,.088,.0132,.25]),e("lz",[2,.0054,.2302,,.2346,.76,,-.6154,.0044,.0708,.0179,.0085,.066,.5,-.5604,.0104,.0832,-.0182,.9625,.0138,.1126,.088,.0132,.15]),e("upl",[0,,.26,,.8,.45,,.305,,,,,,.5555,,.6,,,1,,,,,.25]),e("hp",[0,,.2084,,.2832,.5027,,-.48,.6599,,,,,.316,,,,,.5663,,,,,.5]),e("blip",[1,,.1086,,.1316,.2639,,,,,,,,,,,,,1,,,.1,,.25]),e("har",[3,,.1128,.95,.51,.4741,,-.287,,,,,,,,.3824,.5549,-.2718,1,,,,,.25]),e("uplf",[1,,.57,.1,.0482,.16,,,.02,.11,.32,,,,,,,,1,,,.1,,.25]),e("lvlf",[0,,.52,.25,1,.27,,,,.47,.12,.1999,.14,.3,.6399,.552,,,1,,.13,,,.25]),e("lvlc",[0,.04,.23,.19,.59,.24,,,,,,,,.5161,,,,,1,,,.1,,.25]),e("hit",[3,,.0887,,.1681,.6516,,-.4825,,,,,,,,,,,1,,,.129,,.25]),e("sp",[1,,.34,,.67,.16,,.4536,,,,-.24,,,,.4182,,,.39,,,,,.25]),e("lvls",[3,.28,.31,.08,.7,.0081,,.4503,.0324,.8,.3,.62,.25,.3357,.1636,-.9992,.06,.24,.9625,,-.7401,,.0036,.3])},t.playSound=function(e){if(t.mute)return;let s=t.sounds[e],i=s&&s.cc++%s.cha.length;s.cha[i].play()},t.setError=function(){t.error=!0},t.setLoop=function(e){setInterval(s=>{t.error||(t.delta_t=.013,t.frame++,t.frame>720&&(t.frame=0),e())},13)},t.getCtx=function(){return t.ctx},t.clearScreen=function(){let e=t.getCtx();e.fillStyle="black",e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.rect=function({x:e=0,y:s=0,w:i,h:h,color:r,c:a,rot:l=0,outline:c=!1}){let n=t.getCtx();n.rotate(l*Math.PI/180),c&&(n.fillStyle="#111",n.fillRect(e-i/2-1,s-h/2-1,i+2,h+2)),n.fillStyle=r||a,n.fillRect(e-i/2,s-h/2,i,h)},t.circle=function({x:e=0,y:s=0,r:i=0,color:h,c:r,o:a}){let l=t.getCtx();l.lineWidth=3,l.fillStyle=h||r,l.beginPath(),l.arc(e,s,i,0,2*Math.PI),a?(l.strokeStyle=h||r,l.stroke()):l.fill()},t.rotate=function(e,{x:s=0,y:i=0,w:h=0,h:r=0}){let a=t.getCtx();return void 0!==e&&(s-=h/2,i-=r/2,a.translate(s,i),a.translate(h,r),a.rotate(e*Math.PI/180),s=-h/2,i=-r/2),{x:s,y:i}},t.line=function({x:e,y:s,x2:i,y2:h,color:r,w:a=3}){let l=t.getCtx();l.beginPath(),l.lineWidth=a,l.strokeStyle=r,l.moveTo(e,s),l.lineTo(i,h),l.stroke()},t.getAnim=function(e){if(t.animations[e]){const s=t.animations[e]();return s.name=e,s}return t.setError(),null},t.rasterize=function(e){let s=document.createElement("canvas"),i=s.getContext("2d");s.width=e.w||1,s.height=e.h||1,t.setCanv(s),i.clearRect(0,0,e.w,e.h),i.save(),i.translate(e.w/2,e.h/2),e.shapes.forEach(e=>{(e.c||e.color)&&(i.save(),e.outline=void 0===e.outline||e.outline,t[e.type||"rect"].call(t,e),i.restore())}),e.canvas=s,i.restore(),t.restoreCanv()},t.drawSprite=function(e,s,i,h,r){let a=this.sprites[e];if(!a)return void t.setError('no sprite exists named "'+e+'"');let l={x:s-a.w/2,y:i-a.h/2};a.x=l.x,a.y=l.y;let c=t.getCtx();c.save(),void 0===r?a.drot&&(l=t.rotate(t.frame*a.drot%360,a)):l=t.rotate(r,a),c.drawImage(a.canvas,l.x,l.y),c.restore()},t.drawText=function(e,s,i,h){let r=t.getCtx(),{font:a,size:l,color:c,c:n}=h||{};r.font=(l||16)+"px "+(a||"monospace"),r.fillStyle=c||n||"white",r.fillText(e,s,i)},t.drawAnim=function(e,s,i,h,r){let a=e.getSprite();t.drawSprite(a,s,i,h,r),e.update()},t.drawAnimation=t.drawAnim,t.init=function(s,i){if(s&&(t.canvasid=s,t.restoreCanv()),t.loaded)return void i();if(t.loading)return;t.loadSounds(),window.app.sprites.createSprites();t.cAnim("pl_default",()=>{let t=new e("",!1);return t.s("p2",5),t}),t.cAnim("pl_from_left",()=>{let t=new e("",!1);return t.s("p1",5),t.s("p2",5),t}),t.cAnim("pl_from_right",()=>{let t=new e("",!1);return t.s("p3",5),t.s("p2",5),t}),t.cAnim("pl_left",()=>{let t=new e("",!1);return t.s("p1",5),t.s("p0",5),t}),t.cAnim("pl_right",()=>{let t=new e("",!1);return t.s("p3",5),t.s("p4",5),t});t.cAnim("expl_air",()=>{let t=new e("",!1);for(let e=0;e<=4;e++)t.s(`expl${e}`,6);return t}),t.cAnim("expl_bomb",()=>{let t=new e("",!1);for(let e=5;e<=9;e++)t.s(`expl${e}`,6);return t}),t.cAnim("expl_lazer",()=>{let t=new e("",!1);for(let e=0;e<=2;e++)t.s(`expl1${e}`,6);return t}),t.cAnim("cache",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`cache${e}`,4);return t.s("cache1",4),t}),t.cAnim("flash",()=>{let t=new e("",!1);return t.s("flash1",5),t}),t.cAnim("pwrcoin",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`pc${e}`,4);return t.s("pc1",8),t}),t.cAnim("plug",()=>{let t=new e("",!0);for(let e=0;e<=2;e++)t.s(`plug${e}`,4);return t.s("plug1",8),t}),t.cAnim("plugdead",()=>{let t=new e("",!1);return t.s("plug4",8),t}),i()},window.app.display=t}(),window.app.level="sl,275,1|sl,533,2|sl,800,3|bl,1,1|bl,279,2|bl,538,3|p,80,15|s,38,c,a,1,15|u,10,57,4|u,15,41,4|c,27,73,5,2x|g,10,65,1|g,9,41,1|g,24,81,1|g,3,94,1|c,15,105,5,coin5|c,29,107,5,coin2|u,7,114,2|u,15,126,2|g,15,116,1|g,7,125,1|g,28,123,1|c,19,144,10,hp|u,13,178,4|g,25,185,1|g,3,208,1|g,10,226,1|p,257,20|u,5,241,2|u,28,243,2|g,11,246,2|g,29,240,1|c,20,249,5,coin3|s,62,c,a,1,15|s,70,c,a,1,15|s,77,c,a,1,15|w,78,5,s,78,c,a,1,15|s,89,l,a,1,15|s,96,r,a,1,10|s,111,l,a,1,10|w,78,5,s,78,l,a,1,5|w,78,10,s,78,c,a,1,20|s,128,r,a,1,10|s,147,r,a,1,10|s,186,a,a,1,26|s,208,r,a,1,20|s,223,r,a,1,20|s,238,r,a,1,20|s,255,c,a,1,10|s,255,r,a,1,10|s,255,l,a,1,10|s,216,l,a,1,10|s,232,l,a,1,10|s,199,l,a,1,10|s,163,c,a,1,10|s,168,l,a,1,10|s,139,l,a,1,15|c,12,193,5,2x|c,23,228,5,hp|s,50,c,a,1,15|u,25,14,3|w,255,8,s,255,c,a,1,15|t,20,15,  Press c (k) to uplink.|t,1,15,Press x (j) to bomb ground targets.|t,9,5, Hold z (wyq) to shoot air targets.|c,20,305,10,lazer|g,22,326,2|g,9,345,2|g,13,355,2|g,22,366,2|g,14,380,2|g,20,380,1|c,25,384,10,hp|u,19,366,4|u,16,355,4|u,12,345,4|u,14,376,5|g,8,400,2|g,22,410,2|g,10,424,2|g,21,441,2|g,8,464,2|g,11,486,2|u,26,400,4|u,9,411,4|u,18,429,4|u,11,441,4|u,12,463,4|u,20,463,4|u,9,496,4|c,5,509,10,hp|c,10,512,10,2x|c,16,509,10,hp|c,21,512,10,coin5|p,525,10|g,24,464,1|p,475,20|s,319,l,a,1,21|s,333,c,a,1,25|s,350,a,a,2,25|s,369,a,a,1,20|p,390,15|s,388,c,a,2,10|w,388,5,s,388,a,a,1,25|s,400,c,a,2,10|s,417,l,a,2,25|s,441,r,a,2,15|s,473,a,a,2,25|w,473,5,s,473,r,a,1,15|w,473,5,s,473,l,a,1,15|w,473,15,s,473,r,a,2,10|w,486,10,s,486,c,a,2,15|w,496,10,s,496,c,a,2,15|p,18,91|c,8,14,5,coin3|g,28,593,2|g,4,787,3|g,15,783,2|g,27,787,3|u,4,776,5|u,10,749,5|u,8,759,5|u,8,707,5|u,25,654,5|u,15,560,5|c,20,560,10,lazer|c,28,589,10,2x|c,16,602,10,coin6|g,16,598,3|g,4,656,3|g,8,669,3|u,25,618,5|u,7,634,5|u,12,685,5|g,27,692,3|c,29,682,10,coin4|c,19,696,10,coin4|c,3,692,10,2x|u,25,704,5|g,19,715,2|g,2,720,2|g,3,739,2|g,9,744,2|u,15,776,5|p,794,43|s,577,a,a,3,8|s,590,a,a,4,6|s,604,l,a,2,12|s,622,c,a,4,10|s,650,a,a,3,20|s,671,c,a,4,10|s,696,c,a,4,10|s,731,c,a,4,10|s,756,c,a,4,10|s,768,a,a,4,20|s,619,l,a,3,9|s,676,l,a,3,9|s,708,l,a,3,9|s,744,l,a,3,9|s,634,r,a,3,18|s,688,r,a,3,9|s,731,r,a,3,9|s,756,r,a,3,9|s,791,a,a,4,10|w,791,5,s,791,a,a,4,8|w,791,8,s,791,a,a,4,12|w,791,12,s,791,a,a,4,12|w,790,20,s,790,a,a,4,50|w,791,20,s,791,a,a,4,15|w,790,20,s,790,l,a,4,20|w,791,30,s,791,c,a,4,10|u,27,776,5|s,685,a,a,4,15|s,662,a,a,4,15|t,13,9,Arrows to move.|c,11,740,10,hp|c,5,664,10,hp|c,6,782,15,coin10|c,25,782,15,coin10|s,155,c,a,1,10|s,797,a,a,4,25",function(){let t=window.app.display,e=window.app.terrain={},s=e.tile_width=25,i=e.tile_height=32,h=-6,r=7,a={size:24},l=null,c=function(){return Math.round(t.normalize.apply(null,arguments))},n=123456;function o(){let t=1e4*Math.sin(n++);return t-Math.floor(t)}function p(t){return t[Math.floor(o()*t.length)]}function d(t,e,s){return e*s+t}function u(t,e){return e>=0&&t>=0&&t<32}function f(t,e,s,i){let h=d(t,e,32);if(s[h].type===i||t<1||e<1||t>31)return!1;let r=s[h+1],a=s[h-1];var l=s[h-32],c=s[h+32];return!(!r||r.type!==i)||(!(!a||a.type!==i)||(!(!l||l.type!==i)||!(!c||c.type!==i)))}let x={none:{ch:" ",fg:["#FFF"],bg:["#000"]},tr:{ch:" ",fg:["#373","#363"],bg:["#031","#040","#121"]},gr:{ch:" ",fg:["#3A3","#5D5"],bg:["#464","#252","#151"]},dirt:{ch:".,,\"`'",fg:["#3DD","#394"],bg:["#584","#871","#662"]},mtn:{ch:"/\\^#",fg:["#773"],bg:["#330"]},mtn2:{ch:"  ^",fg:["#98A"],bg:["#546","#557"]},wtr:{ch:"~ ",fg:["#3FF","#4FF"],bg:["#005","#004"]},shore:{ch:"  _.",fg:["#EB8"],bg:["#765","#764","#775"]},rock:{ch:"~.",fg:["#F22","#F33","#F44"],bg:["#111","#112","#122","#222"]},lava:{ch:"~*  ",fg:["#F82","#FA3"],bg:["#611","#511"]},lshore:{ch:"  _.",fg:["#CB8"],bg:["#755","#855"]},w:{ch:"#@",fg:["#111","#222"],bg:["#622","#722","#822"]}};function w(t,e,s){let i=x[t];return{type:t,x:e,y:s,ch:p(i.ch),fg:p(i.fg),bg:p(i.bg),ref:i}}function m(t,e,s,i){let h=c(o(),0,1,8,15);for(let r=e;r<h+e;r++)for(let a=t;a<h+t;a++){if(!u(a,r))continue;let l=!1;i[d(a,r,32)]=w(p(s),a,r);let n=c(o(),0,1,1,4),f={x:0,y:0};if(r===e?(f.y=-1,l=!0):a===t?(f.x=-1,l=!0):a===t-1+h?(f.x=1,l=!0):r===e-1+h&&(f.y=1,l=!0),l)for(let t=1;t<=n;t++){let e=a+t*f.x,h=r+t*f.y;u(e,h)&&(i[d(e,h,32)]=w(p(s),e,h))}}}function g(t,e,s,i,h){m(t,e,[s],h),function(t,e,s,i,h){for(let t=e-32;t<e+32;t++)if(!(t<0))for(let e=0;e<32;e++)f(e,t,h,s)&&(h[d(e,t,32)]=w(i,e,t))}(0,e,s,i,h)}function y(t,e){let s=d(0,t,32);for(let i=0;i<32;i++)e[i+s]=w("w",i,t),e[i-32+s]=w("w",i,t-1),e[i+32+s]=w("w",i,t+1)}e.set=function(){n=123456;let u=function(t,e){let s=[];for(let i=0;i<t;i++)for(let t=0;t<e;t++)s.push(w("none",t,i));for(let t=0;t<266;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=w(o()>.5?"tr":"gr",i,t);for(let t=266;t<533;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=w("tr",i,t);for(let t=533;t<800;t++)for(let i=0;i<e;i++)s[d(i,t,32)]=w("rock",i,t);for(let t=0;t<6;t++)m(c(o(),0,1,0,31),c(o(),0,1,50,266),["dirt"],s);for(let t=0;t<24;t++)m(c(o(),0,1,0,31),c(o(),0,1,50,400),["mtn"],s);for(let t=0;t<20;t++)g(c(o(),0,1,0,31),c(o(),0,1,50,400),"wtr","shore",s);for(let t=0;t<10;t++)m(c(o(),0,1,0,31),c(o(),0,1,50,400),["tr"],s);for(let t=0;t<10;t++)m(c(o(),0,1,0,5),c(o(),0,1,0,266),["gr"],s);for(let t=0;t<40;t++)m(c(o(),0,1,0,20),c(o(),0,1,266,533),["mtn","mtn2"],s);for(let t=0;t<20;t++)m(c(o(),0,1,0,20),c(o(),0,1,420,800),["mtn2"],s);for(let t=0;t<30;t++)g(c(o(),0,1,0,25),c(o(),0,1,566,770),"lava","lshore",s);return y(0,s),y(276,s),y(533,s),s}(800,32),f=l=document.createElement("canvas");f.width=32*s,f.height=800*i,t.setCanv(f),u.forEach(e=>{!function(e,l){let c=Math.floor,n=e.x*s+s/2,d=l.height-i-e.y*i+i/2;if(t.ctx.save(),t.rect({x:n,y:d,w:s,h:i,color:e.bg}),"gr"===e.type||"tr"===e.type||e.type.indexOf("rock")>-1){let h=1+Math.floor(5*o());for(let r=0;r<h;r++){let h=n+c(o()*s),r=d+c(o()*i),a=c(o()*s);t.circle({x:h,y:r,r:a,color:p(e.ref.bg)})}}t.ctx.restore(),a.color=e.fg,t.drawText(e.ch,n+h,d+r,a)}(e,f)}),t.restoreCanv(),e.height=f.height},e.getYOffset=function(e){return-l.height+t.height+e},e.draw=function(s){t.ctx.drawImage(l,0,e.getYOffset(s))}}(),function(){let t=window.app.display,e=t.createSprite.bind(t),s=function({c:t,x:e,y:s,w:i,h:h,rot:r,o:a}){return{type:"rect",c:t||"red",w:i||25,h:h||32,x:e||0,y:s||0,rot:r,outline:a}},i=function({c:t,r:e,x:s,y:i}){return{type:"circle",c:t||"rgba(220,220,220,1.0)",r:e||2,x:s||0,y:i||0}},h=[{c:"#111",w:32,h:32,rot:45},{c:"#44F",w:30,h:30,rot:45},{c:"#0AF",w:15,h:15,rot:45},{c:"#111",w:15,h:15,y:20,x:20},{c:"#44F",w:15,h:15,y:20,x:20},{c:"#77A",w:6,h:30,y:0,x:20},{c:"#111",w:15,h:15,y:20,x:-20},{c:"#44F",w:15,h:15,y:20,x:-20},{c:"#77A",w:6,h:30,y:0,x:-20}],r=[{w:40,h:40,rot:0},{w:40,h:40,rot:22.5},{w:40,h:40,rot:30},{w:40,h:40,rot:45},{w:40,h:40,rot:60},{w:40,h:40,rot:67.5},{w:20,h:20},{w:10,h:10,rot:45}],a=[s({}),s({w:50,h:64}),s({}),s({x:-25}),s({x:25}),s({y:-32}),s({y:32})],l=[{type:"circle",r:27},{type:"circle",r:25},{type:"circle",r:21},{type:"circle",r:15},{type:"circle",r:9},{w:5,h:10}],c=window.app.sprites={air_sz:40,pl_sz:35,get:function(t,e){let s="air"===t?r:"ground"===t?a:"cache"===t?l:[];return JSON.parse(JSON.stringify(s)).map((t,s)=>(t.c=e[s],t))},createSprites(){let t=[];for(let e=0;e<20;e++)t.push("#FFF");function r(t){return`rgba(220,220,220,${t})`}e("none",0,[i({r:10})],9,9),e("expl0",5,[i({r:2})],99,99),e("expl1",5,[i({r:15})],99,99),e("expl2",5,[i({r:30})],99,99),e("expl3",5,[i({r:38,c:r(.6)})],99,99),e("expl4",5,[i({r:40,c:r(.3)})],99,99),e("expl5",5,[i({r:1,c:r(.8)})],99,99),e("expl6",5,[i({r:8,c:r(.8)})],99,99),e("expl7",5,[i({r:15,c:r(.8)})],99,99),e("expl8",5,[i({r:19,c:r(.6)})],99,99),e("expl9",5,[i({r:20,c:r(.3)})],99,99),e("expl10",5,[i({r:2,c:"#FF0"})],25,25),e("expl11",5,[i({r:10,c:"#FF0"})],25,25),e("expl12",5,[i({r:12,c:"#FF0"})],25,25),e("air1",2,c.get("air",["#077","","","#084","","","#0DD",""]),80,80),e("air2",2,c.get("air",["#630","","#930","","#A30","","#A90",""]),80,80),e("air3",3,c.get("air",["#7803C4","","#9720D2","","#B73DE0","","#D75AEE","#F777FD"]),80,80),e("air4",4,c.get("air",["#444","#444","","#444","","#444","#777","#999"]),80,80);for(let s=1;s<=4;s++)e(`air${s}dmg`,2,c.get("air",t),80,80);e("ground1",0,c.get("ground",["#BBB","#981","#666","#878","#878","#878","#878"]),75,96),e("ground2",0,c.get("ground",["#BBB","#666","#999","#999","#999","#999","#878"]),75,96),e("ground3",0,c.get("ground",["#BBB","#666","#999","#999","#999","#999","#878"]),75,96);for(let s=1;s<=3;s++)e(`ground${s}dmg`,0,c.get("ground",t),75,96);e("grounddead",0,c.get("ground",["#111","#222","#333","#676","#565","#676","#454"]),75,96),e("turret1",0,[s({c:"#333",w:12,h:30}),s({c:"#981",w:16,h:16,y:-15})],75,96),e("turret2",0,[s({c:"#333",w:8,h:30,x:-5}),s({c:"#333",w:8,h:30,x:5})],75,96),e("turret3",0,[s({c:"#333",w:5,h:30,x:-6}),s({c:"#333",w:5,h:30}),s({c:"#333",w:5,h:30,x:6})],75,96),e("lazer1",0,[{c:"#FFF",w:4,h:14}],4,20),e("lazer2",0,[{c:"#0FF",w:4,h:20},{c:"#FFF",w:2,h:16}],4,20),e("lazer3",0,[{c:"#FF0",r:4},{type:"circle",c:"#FFF",r:3}],12,12),e("bomb1",0,[{type:"circle",c:"#4AA",r:7},{type:"circle",c:"#0FF",r:5},{type:"circle",c:"#FFF",r:2}],14,14),e("bullet1",0,[{type:"circle",c:"#900",r:7},{type:"circle",c:"#F88",r:5}],12,12),e("bullet2",0,[{type:"circle",c:"#990",r:8},{type:"circle",c:"#FF8",r:6}],14,14),e("bullet3",0,[{type:"circle",c:"#909",r:9},{type:"circle",c:"#F8F",r:7}],12,12),e("btgt",3,[{c:"#C44",rot:45,w:2,h:14},{c:"#C44",rot:-45,w:2,h:14}],50,50);const a=["#111","#555","#344","#466","#599","#FF1","#3A5","#3A5","#3A5","#3A5"];e("cache0",0,c.get("cache",a),65,65);const l=a.slice();l[2]="#354",l[3]="#476",l[4]="#6A9",e("cache1",0,c.get("cache",l),65,65);const n=a.slice();n[2]="#355",n[3]="#486",n[4]="#6AA",e("cache2",0,c.get("cache",n),65,65);const o=a.slice();o[1]="#111",o[2]="#111",o[3]="#222",o[4]="#222",o[5]="#111",e("cachedead",0,c.get("cache",o),65,65),e("cachedmg",0,c.get("cache",t),65,65),e("flash1",0,[{c:"#FFF",rot:45,w:2,h:12,y:-10},{c:"#FFF",rot:-45,w:2,h:12,y:-10}],50,50),e("target",0,[{c:"#0F0",rot:45,w:2,h:18},{c:"#0F0",rot:-45,w:2,h:18}],50,50),e("pwrhp",0,[i({r:18,c:"#111"}),i({r:16,c:"#55F"}),s({x:-6,w:10,h:4,c:"#FFF"}),s({x:-11,w:4,h:14,c:"#FFF"}),s({x:-1,w:4,h:14,c:"#FFF"}),s({x:5,w:4,h:14,c:"#FFF"}),i({x:10,y:-2,r:5,c:"#FFF"}),i({x:10,y:-2,r:2,c:"#111"})],99,99),e("pwrlazer",0,[i({r:22,c:"#EEE"}),i({r:20,c:"#F92"}),s({w:6,h:20,c:"#FFF"}),s({w:20,h:5,c:"#FFF"})],99,99),e("pc0",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"})],99,99),e("pc1",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"}),s({x:-3,y:-2,w:3,h:1,c:"#FFF",o:0}),s({x:-3,y:-2,w:2,h:3,c:"#FFF",o:0})],99,99),e("pc2",0,[i({r:12,c:"#FF0"}),i({r:10,c:"#AA0"}),s({x:-3,y:-2,w:8,h:1,c:"#FFF",o:0}),s({x:-3,y:-2,w:1,h:8,c:"#FFF",o:0})],99,99),e("pwr2x",0,[s({rot:45,w:8,h:30,c:"#F2F"}),s({rot:-45,w:8,h:30,c:"#F2F"})],99,99),e("harpoon",0,[s({x:-5,y:10,w:4,h:20,c:"#888"}),s({x:5,y:10,w:4,h:20,c:"#888"}),s({w:20,h:4,c:"#888"})],99,99),e("plug0",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AAA"}),s({x:10,y:-12,w:4,h:25,c:"#AAA"}),s({w:30,h:4,c:"#AAA"})],99,99),e("plug1",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AAF"}),s({x:10,y:-12,w:4,h:25,c:"#AAF"}),s({w:30,h:4,c:"#ABB"})],99,99),e("plug2",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#AFF"}),s({x:10,y:-12,w:4,h:25,c:"#AFF"}),s({w:30,h:4,c:"#AEE"})],99,99),e("plug4",0,[i({r:29,c:"#111"}),i({r:28,c:"#555"}),s({w:25,h:25,c:"#777"}),s({x:-10,y:-12,w:4,h:25,c:"#777"}),s({x:10,y:-12,w:4,h:25,c:"#777"}),s({w:30,h:4,c:"#777"})],99,99);let p=t=>{let e=JSON.parse(JSON.stringify(h));for(let s=3;s<9;s++)e[s].x=e[s].x/t;return e[2].w/=t,e[2].h/=t,e=[e[6],e[7],e[8]].concat([e[0],e[1],e[2],e[3],e[4],e[5]])};e("p4",0,p(-2),200,200),e("p3",0,p(-1.5),200,200),e("p2",0,h,200,200),e("p1",0,p(1.5),200,200),e("p0",0,p(2),200,200)}}}(),function(){let t,e=window.app.display,s=window.app.sprites,i=window.app.terrain,h=localStorage,r=e.height,a=e.width,l=e.drawText,c=e.playSound,n="",o=.9,p=parseInt,d=t=>`rgba(0,0,0,${t})`;function u(t,e){return t<e||t>360-e&&t<360}class f{constructor(t){this.f=0,this.name=t,this.speed=6,this.mxsd=4,this.x=0,this.y=0,this.r=10,this.w=10,this.h=10,this.vx=0,this.vy=0,this.ax=0,this.maxax=1,this.hp=1,this.ac=.2,this.dc=.05,this.hed=0,this.isac=!1,this.remv=!1,this.state="",this.expl="expl_air",this.anim=null,this.spr=null,this.ai=function(){}}setState(t){this.state!==t&&(this.state=t,this.anim=e.getAnim(this.name+"_"+t))}getHedTo({x:t,y:e}){let s=e-this.y,i=t-this.x,h=Math.sqrt(i*i+s*s),r=0;return(r=e>=this.y&&t>=this.x?180*Math.asin(s/h)/Math.PI+90:e>=this.y&&t<this.x?180*Math.asin(s/-h)/Math.PI-90:e<this.y&&t>this.x?180*Math.asin(s/h)/Math.PI+90:180*Math.asin(-s/h)/Math.PI-90)>=360&&(r=360-r),r<0&&(r=360+r),r}pointAt({x:t,y:e}){this.hed=this.getHedTo({x:t,y:e})}turn(t){this.ax="l"===t?-this.maxax:this.maxax}turnTowards({x:t,y:e}){let s=this.getHedTo({x:t,y:e});this.hed<=s?Math.abs(this.hed-s)<180?this.turn("r"):this.turn("l"):Math.abs(this.hed-s)<180?this.turn("l"):this.turn("r")}acc(){let{x:t,y:s}=e.hedToVec(this.hed,this.mxsd);this.vx<t?this.vx+=this.ac:this.vx>t&&(this.vx-=this.ac),this.vy<s?this.vy+=this.ac:this.vy>s&&(this.vy-=this.ac),this.isac=!0}decc(){this.vx<0?this.vx+=this.dc:this.vx>0&&(this.vx-=this.dc),this.vy<0?this.vy+=this.dc:this.vy>0&&(this.vy-=this.dc),Math.abs(this.vx)<.001&&(this.vx=0),Math.abs(this.vy)<.001&&(this.vy=0)}coll({x:s,y:i,r:h}){if(t.nc)return!1;let r=e.distance(s,i,this.x,this.y);if(r<h+this.r&&!this.remv){return{x:this.x-s,y:this.y-i,d:r}}}explode(){this.remv=!0,this.expl&&t.addPar(this.expl,this.x,this.y)}fire(s,i,h){let r=()=>{let s=this.hed-20+40*Math.random(),h=new t.Bullet(i,s),{x:r,y:a}=e.hedToVec(this.hed,25);h.x=this.x+r,h.y=this.y+a,t.a.push(h),t.addPar("flash",h.x,h.y).hed=this.hed,c("bullet")};for(let e=0;e<h;e++)t.setCB(r,5*e+1,!0)}damage(t){return this.hp-=t,this.hp<=0&&(this.explode(),!0)}update(){this.ai&&!t.nc&&this.ai(),this.x+=this.vx,this.y+=this.vy,this.hed+=this.ax,this.hed>=360&&(this.hed=this.hed-360),this.hed<0&&(this.hed=360+this.hed),this.ax=0,this.isac||this.decc(),this.isac=!1,this.f++}draw(){this.anim?e.drawAnim(this.anim,this.x,this.y,1,this.hed):this.spr&&e.drawSprite(this.spr,this.x,this.y)}}class x extends f{constructor(s){super(s),this.spr=s,this.expl="expl_air",this.level=parseInt(s.slice(-1)),this.dmg=[0,3,5,8,10][this.level],this.mxsd=[0,4,5,6,7][this.level],this.hp=[0,1,5,15,20][this.level],this.maxax=[0,1,1,1.5,2][this.level],this.ai=(()=>{let s=t.pl;if(this.f>420)this.hed=180,this.acc();else if(this.f>540)this.explode();else if(this.y>200){if(this.turnTowards(s),e.distance(this.x,this.y,s.x,s.y)>40){u(Math.abs(this.hed-this.getHedTo(s)),90)&&this.acc()}}else this.acc()})}damage(s){super.damage(s),this.anim=e.getAnim(this.name+"dmg"),t.setCB(()=>{this.dead||(this.anim=e.getAnim(this.name))},6,!0)}explode(){super.explode(),c("expa"),t.aPts(50*this.level)}update(){super.update();let e=t.pl;this.coll({x:e.x,y:e.y,r:s.pl_sz})&&(c("hit"),this.explode(),t.pl.damage(this.dmg))}}class w extends f{constructor(t,s,i){super(t),this.tx=s,this.ty=i,this.w=75,this.h=96,this.x=25*s,this.r=this.w/2,this.spr=t,this.level=parseInt(t.slice(-1)),this.dspr="grounddead",this.anim=e.getAnim(t),this.maxax=2,this.dead=!1}explode(){for(let e=0;e<5;e++)t.addPar(this.expl,this.x-25+50*Math.random(),this.y-25+50*Math.random());this.anim=e.getAnim(this.dspr),this.dead=!0}damage(s){super.damage(s),this.dead||(this.anim=e.getAnim(this.name+"dmg"),t.setCB(()=>{this.dead||(this.anim=e.getAnim(this.name))},6,!0))}getY(){return 32*(800-this.ty)+i.getYOffset(t.tyoff)}isVisible(){let t=this.getY();return t>=-100&&t<=r+100}update(){this.y=this.getY(),super.update()}draw(){if(this.isVisible()){let t=this.getY(),s=25*this.tx;e.drawAnim(this.anim,s,t),!this.dead&&this.tranim&&e.drawAnim(this.tranim,s,t,1,this.hed)}}}class m extends w{constructor(s,i,h){super(s,i,h),this.tranim=e.getAnim("turret"+this.level),this.hp=[0,6,12,16][this.level],this.firerate=[0,170,130,100][this.level],this.ai=(()=>{let s=t.pl;if(!this.dead&&this.getY()>50&&this.getY()<r){this.turnTowards(s),u(Math.abs(this.hed-this.getHedTo(s)),25)&&e.frame%this.firerate==0&&this.fire("bullet",this.level,8)}})}explode(){super.explode(),t.nc||c("expg"),t.aPts(200*this.level)}}class g extends w{constructor(t,e,s,i){super("cache",t,e),this.hp=s,this.dspr="cachedead",this.wh=i}explode(){if(super.explode(),"hp"===this.wh)t.addPowerup("hp",this.x,this.y,0,1);else if(this.wh.indexOf("coin")>-1){let e=parseInt(this.wh.slice(4)),s=Math.random;for(let i=0;i<e;i++)t.addPowerup("coin",this.x,this.y,6*s()-3,6*s()-3)}else"lazer"===this.wh?t.addPowerup("lazer",this.x,this.y,0,1):"2x"===this.wh&&t.addPowerup("2x",this.x,this.y,0,1);t.aPts(100),91===n&&t.go(1)}}class y extends w{constructor(t){super("none",10,t),this.loc="c",this.level=1,this.amt=5,this.wait=0,this.pscds=0,this.blvl=0,this.elvl=0}update(){if(this.isVisible()&&!t.nc)if(this.remv=!0,this.pscds)n=this.pscds,t.tss=0,t.setCB(()=>{t.tss=o},60*this.pscds,!0);else if(this.wait)t.setCB(()=>{for(let e=0;e<this.amt;e++)t.spawns.push(this.loc+",air"+this.level)},60*this.wait,!0);else if(this.elvl)t.endLevel();else for(let e=0;e<this.amt;e++)t.spawns.push(this.loc+",air"+this.level)}draw(){}}class v extends w{constructor(t,s,i,h){super(t+"1",s,i),this.anim=e.getAnim("plug"),this.deadanim=e.getAnim("plugdead"),this.r=25,this.nframes=60*h,this.ai=function(){}}draw(){if(this.isVisible()){let t=this.getY(),s=25*this.tx;this.dead?e.drawAnim(this.deadanim,s,t):e.drawAnim(this.anim,s,t)}}}class b extends f{constructor(t,s,i){super("p"),this.x=s,this.y=i,this.anim=e.getAnim(t)}update(){super.update(),this.anim.is_done&&(this.remv=!0)}}class F extends b{constructor(t,e,s,i){super("expl_air",e,s),this.text=t,this.vy=-1,this.color="#FFF",this.dc=0,this.mfrs=60,this.is_ground=i||!1,this.size=30,i&&(this.size=20,this.vy=0)}update(){super.update(),this.is_ground?(this.y+=t.tss,this.y>r&&(this.remv=!0)):this.f>this.mfrs&&(this.remv=!0)}draw(){l(this.text,this.x,this.y,this)}}t={keys:{},cbs:[],cbs_pll:[],hscore:h&&h.getItem("score")||0,score:0,smult:1,init(){r=e.height,a=e.width,t.paused=!0,t.setEvents(),e.clearScreen(),e.setLoop(t.loop)},start(){c("lvls"),t.loading=!0,setTimeout(()=>{n="",Object.assign(t,{loading:0,started:1,paused:0,scrolling:1,lvln:1,a:[],spawns:[],pl:new class extends f{constructor(){super("pl"),this.x=400,this.y=400,this.r=25,this.mtgy=-150,this.tgy=-150,this.setState("default"),this.lzrcd=20,this.lzfrm=20,this.lzlvl=1,this.mhp=100,this.hp=this.mhp,this.uplink=null,this.bombs=[],this.bfrm=0}lazer(){if(this.lzfrm>this.lzrcd){if(this.lzfrm=0,1===this.lzlvl)for(let e=0;e<3;e++){let s=new t.Lazer(1,!0),i=new t.Lazer(1);s.vy=i.vy=-9,s.damage=i.damage=1,s.delay=i.delay=3*e,s.x_offset=-5,i.x_offset=5,t.a.push(s,i)}else if(2===this.lzlvl)for(let e=0;e<4;e++)for(let s=-10;s<=10;s+=10){let i=new t.Lazer(2,-10===s);i.vy=-14,i.damage=3,i.delay=3*e,i.x_offset=s,t.a.push(i)}else if(3===this.lzlvl)for(let s=0;s<4;s++)for(let i=1;i<6;i++){let h=new t.Lazer(3,1===i);h.vx=e.normalize(i,0,6,-3,3),h.delay=3*s,h.damage=5,h.x_offset=h.vx,t.a.push(h)}t.score-=10}}bomb(){if(0===this.bombs.length){let e=[0,1,2,4][t.lvln];for(let s=0;s<e;s++){let e=new t.Bomb(1,this.x,this.y,this.tgy);this.bombs.push(e)}}}harpoon(){if(!this.uplink){let e=new t.Harpoon(1,this.x,this.y);this.uplink=e,c("har"),t.a.push(e)}}explode(){t.nc||(c("lvlf"),t.end())}plusHP(t){(this.hp+=t)>this.mhp&&(this.hp=this.mhp)}update(){let e=!1;t.keys.arrowleft&&(e=!0,this.x-=this.speed),t.keys.arrowright&&(e=!0,this.x+=this.speed),t.keys.arrowup&&(this.y-=this.speed),t.keys.arrowdown?this.y+=this.speed:(this.tgy-=4,this.tgy<this.mtgy&&(this.tgy=this.mtgy)),t.keys.z&&this.lazer(),e||"left"!==this.state&&"right"!==this.state||("left"===this.state?this.setState("from_left"):this.setState("from_right")),this.x<0?this.x=0:this.x>a?this.x=a:this.y<0?this.y=0:this.y>r&&(this.y=r,t.keys.arrowdown&&(this.tgy+=4,this.tgy>0&&(this.tgy=0))),this.lzfrm++,this.uplink&&this.uplink.remv&&(this.uplink=null),this.bombs.length&&(this.bfrm<=0?(this.bfrm=4,c("bomb"),t.a.push(this.bombs.shift())):this.bfrm--)}draw(){super.draw(),e.drawSprite("target",this.x,this.y+this.tgy-16);let t=e.normalize(this.hp,0,this.mhp,0,160),s=r-10-2,i=a-160+80-20,h=a-160+t/2-20;e.rect({x:i,y:s,w:160,h:10,c:"red",outline:1}),e.rect({x:h,y:s,w:t,h:10,c:"blue",outline:1});let c=Math.round(100*this.hp/this.mhp)+"%";l(c,i-6.5*c.length,s+2,{size:24,color:"white"})}},score:0,smult:1,spfr:0,tss:o,i:null}),t.createObjects(),t.camToLvl(t.lvln),t.fade(!0)},100)},camToLvl(e){let s=t.a.reduce((t,s)=>t||(s instanceof y&&s.blvl===e+""?s:null),null);t.tyoff=32*s.y},end(e){t.cbs=[],t.cbs_pll=[],t.nc=!0;let s=Math.random,i=t.pl;if(e)c("lvlc"),t.a.forEach(t=>{t instanceof m&&t.explode()}),t.vic=!0,t.setCB(function(){},60);else for(let e=0;e<8;e++)t.addPar("expl_air",i.x-25+50*s(),i.y-25+50*s());t.fade(!1),t.score>t.hscore&&(c("upl"),t.hscore=t.score,h&&h.setItem("score",t.score),t.hs=!0),t.setCB(()=>{t.hs=!1,t.nc=!1,t.started=!1,t.vic=!1},60)},endLevel(){t.tss=0;for(let e=0;e<5;e++)t.setCB(()=>{c("lvlc")},10);t.fade(!1),3!==t.lvln?t.setCB(()=>{t.lvln++,t.fade(!0),t.camToLvl(t.lvln),t.tss=o,c("lvls")},300):t.end(!0)},fade(e){for(let s=0;s<10;s++)e&&(t.fopac=1),t.setCB(()=>{t.fopac=e?Number(((9-s)/9).toFixed(1)):Number((s/9).toFixed(1))},8)},loop:()=>t.paused?(e.clearScreen(),void t.draw()):!t.nc||t.nc&&e.frame%3==0?(t.update(),e.clearScreen(),void t.draw()):void 0,update(){if(this.cbs.length){let t=this.cbs[0];t.current_frame++,t.current_frame>=t.mfrs&&(t.cb(),this.cbs.shift())}if(this.cbs_pll=this.cbs_pll.filter(t=>(t.current_frame++,!(t.current_frame>=t.mfrs)||(t.cb(),!1))),t.started){t.pl.update();for(let e=0;e<t.a.length;e++){let s=t.a[e];s.update(),s.remv&&(t.a.splice(e,1),e--)}t.spawn(),t.scrolling&&(t.tyoff+=t.tss,t.tyoff>i.height-r&&(t.tyoff=i.height-r))}},draw(){if(!t.loading){if(!t.started){let e="High Score "+t.hscore;return l(e,50,50,{size:25,color:"gold"}),l("PLANET: OFFLINE",222,400,{size:42}),void l("Press any key...",288,600,{size:28})}i.draw(t.tyoff);for(let e=0;e<t.a.length;e++){t.a[e].draw()}t.fopac&&e.rect({x:400,y:400,w:800,h:800,color:d(t.fopac)}),t.hs&&l("NEW HIGH SCORE!",220,120+3*Math.random(),{size:42,c:"cyan"}),t.vic&&l("VICTORY!",307,220+3*Math.random(),{size:42,c:"green"}),t.nc||t.pl.draw(),l('ESC to pause, "m" to mute',20,20,{size:16}),l("SCORE: "+t.score+" x"+t.smult,a-260,20,{size:16}),t.paused&&(e.rect({x:400,y:400,w:800,h:800,c:d(.3)}),l("PAUSED",356,400,{size:28}),l("ESC to unpause",341,450,{size:16}))}},spawn(){if(0!==t.spawns.length)if(t.spfr>=10){let s=t.spawns.shift(),i=s.split(",")[0],h=s.split(",")[1],r=new x(h);r.y=-20,r.vy=2,r.hed=180;let l=a/2-100,c=a/2+100;"l"===i?(l=25,c=226):"r"===i?(l=a-225,c=a-25):"a"===i&&(l=50,c=750),r.x=e.randbtwn(l,c),t.a.push(r),t.spfr=0}else t.spfr++;else t.spfr=0},setCB(t,e,s){(s?this.cbs_pll:this.cbs).push({cb:t,mfrs:e,current_frame:0})},addPar(e,s,i,h){let r=new(h?class extends b{constructor(t,e,s){super(t,e,s)}update(){super.update(),this.y+=t.tss}}:b)(e,s,i);return t.a.push(r),r},addText(e,s){s=s||"#FFF";let i=new F(e,a/2-7*e.length,90);return i.color=s,t.a.push(i),i},addPowerup(s,i,h,r,a){let l=new class extends f{constructor(s,i,h,r,a){super("pwr"+s),this.x=i,this.y=h,this.vx=r,this.vy=a,this.anim=e.getAnim("pwr"+s),this.mfrs=360,this.ac=.2,this.maxax=3,this.mxsd=8,this.r=15,this.ai=(()=>{let s=t.pl;if(e.distance(this.x,this.y,s.x,s.y)<100)return this.pointAt(s),void this.acc();"pwrcoin"!==this.name&&(this.turn("l"),Math.random()>.5&&this.acc())})}update(){super.update(),this.f===this.mfrs&&(this.remv=!0),this.coll(t.pl)&&(this.remv=!0,"pwrhp"===this.name&&(t.pl.plusHP(50),c("hp")),"pwrlazer"===this.name&&(t.pl.lzlvl++,t.pl.lzlvl>3&&(t.pl.lzlvl=3),c("sp")),"pwrcoin"===this.name&&(t.aPts(1e3),c("coin")),"pwr2x"===this.name&&(t.addText("2x Points!","#EE5"),t.smult*=2,c("sp")))}draw(){if(this.f>this.mfrs/2&&this.f%8<4)return;let t=this.hed;this.hed=0,super.draw(),this.hed=t}}(s,i,h,r,a);this.a.push(l)},aPts(e){t.score+=e*t.smult},go(e){(1===this.i&&0===e||0===this.i&&1===e)&&(t.tss=o),this.i=e},createObjects(){t.level_frame=0;let e=window.app.level.split("|").map(t=>t.split(","));i.set();let s={w:e=>{let s=new y(p(e[1]));s.loc=e[5],s.wait=e[2],s.type=e[6],s.level=e[7],s.amt=e[8],t.a.push(s)},u:e=>{t.a.push(new v("plug",p(e[1]),p(e[2]),e[3]))},c:e=>{t.a.push(new g(e[1],e[2],e[3],e[4]))},p:e=>{let s=new y(p(e[1]));s.pscds=p(e[2]),t.a.push(s)},s:e=>{let s=new y(p(e[1]));s.loc=e[2],s.type=e[3],s.level=e[4],s.amt=e[5],t.a.push(s)},g:e=>{t.a.push(new m("ground"+e[3],e[1],e[2]))},t:e=>{t.a.push(new F(e[3],25*e[1],32*e[2],!0))},bl:e=>{let s=new y(p(e[1]));s.blvl=e[2],s.amt=0,s.y=p(e[1]),s.x=0,t.a.push(s)},sl:e=>{let s=new y(p(e[1]));s.elvl=e[2],t.a.push(s)}};e.forEach(t=>{s[t[0]](t)})},setEvents(){document.addEventListener("keydown",s=>{let i=s.key.toLowerCase();t.nc||t.keys[i]||(t.keys[i]=!0,t.started?("m"===i&&(e.mute=!e.mute),"escape"===i&&(t.paused=!t.paused),t.paused||("arrowleft"===i&&t.pl.setState("left"),"arrowright"===i&&t.pl.setState("right"),"zwyq".search(i)>-1&&t.pl.lazer(),"xj".search(i)>-1&&t.pl.bomb(),"ck".search(i)>-1&&t.pl.harpoon())):t.start())}),document.addEventListener("keyup",e=>{t.keys[e.key.toLowerCase()]=!1})}},window.app.game=t,t.Actor=f,t.Bullet=class extends f{constructor(t,s){super("bullet_"+t),this.spr="bullet"+t,this.hed=s,this.mxsd=4,this.ac=1,this.r=6;let{x:i,y:h}=e.hedToVec(s,this.mxsd);this.vx=i,this.vy=h,this.dmg=1,this.ai=(()=>{this.f>120&&(this.remv=!0)})}update(){this.f++,this.ai(),this.x+=this.vx,this.y+=this.vy,this.coll(t.pl)&&(c("hit"),t.pl.damage(this.dmg),this.explode())}},t.Bomb=class extends f{constructor(t,e,s,i){super("bomb_"+t),this.x=e,this.sy=s-20,this.y=s,this.tgy=i,this.spr="bomb"+t,this.mfrs=40,this.r=7,this.expl="expl_bomb"}explode(){this.remv=!0,t.addPar(this.expl,this.x,this.y,!0)}update(){if(this.y=this.sy+e.normalize(this.f,0,this.mfrs,0,this.tgy)+this.mfrs*t.tss,this.f++,this.f===this.mfrs){for(let e=0;e<t.a.length;e++){let s=t.a[e];if((s instanceof m||s instanceof g)&&!s.dead&&this.coll(s)){c("sand"),s.damage(1);break}}c("bombg"),this.explode()}}draw(){super.draw(),e.drawSprite("btgt",this.x,this.sy+this.tgy+this.f*t.tss)}},t.Lazer=class extends f{constructor(t,e){super("lazer_"+t),this.damage=1,this.vy=-10,this.vx=0,this.isdel=!0,this.delay=0,this.x_offset=0,this.spr="lazer"+t,this.expl="expl_lazer",this.sound=e}update(){if(this.f++,this.isdel&&this.f>this.delay){const{x:e,y:s}=t.pl;this.isdel=!1,this.x=e+this.x_offset,this.y=s,this.sound&&c("lz")}this.y+=this.vy,this.x+=this.vx;for(let e=0;e<t.a.length;e++){let s=t.a[e];if(s instanceof x&&this.coll(s)){this.explode(),s.damage(this.damage);break}}this.f>180&&(this.remv=!0)}draw(){this.isdel||super.draw()}},t.Harpoon=class extends f{constructor(t,e,s){super("harpoon_"+t),this.x=e,this.y=s,this.spr="harpoon",this.mfrs=40,this.r=7,this.vy=5,this.expl="expl_bomb",this.cn=!1,this.upfrs=120,this.maxdist=300,this.plug=null}update(){let s=t.pl;if(this.f++,this.y+=this.vy,this.x+=this.vx,this.f===this.mfrs)return this.cn&&(c("upl"),t.addText("Uploaded! (+5000)","#5E5"),this.plug.dead=!0,t.aPts(5e3),91===n&&t.go(0)),void this.explode();if(this.cn){this.y+=t.tss;let i=e.distance(this.x,this.y,s.x,s.y);this.f%20==0&&c("blip"),i>this.maxdist&&(c("uplf"),this.explode(),t.addText("Disconnect!","#E55"))}else for(let e=0;e<t.a.length;e++){let s=t.a[e];if(s instanceof v&&!s.dead&&this.coll(s)){t.addText("Uploading..."),this.cn=!0,this.vx=this.vy=this.f=0,this.x=s.x,this.y=s.y,this.mfrs=s.nframes,this.plug=s;break}}}draw(){let{x:s,y:i}=t.pl;e.drawSprite(this.spr,this.x,this.y);let h={x:this.x,y:this.y,x2:s,y2:i,color:"#EEE"};e.line(h),this.cn&&(h.x+=3,h.color="#AAF",e.line(h),h.x-=6,e.line(h),this.f%10<5&&e.line({x:this.x,y:this.y,x2:s,y2:i,color:"#333"}),e.circle({x:this.x,y:this.y,r:this.maxdist,color:"#FFF",o:1}))}}}();
addEventListener('load',()=>{app.display.init('c',app.game.init)})
</script></footer></html>
